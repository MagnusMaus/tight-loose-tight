<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sam - Karriere-Coach</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        #root {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Lucide icons
        const SendIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const FileUpIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const BookmarkPlusIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                <line x1="12" y1="7" x2="12" y2="13"></line>
                <line x1="9" y1="10" x2="15" y2="10"></line>
            </svg>
        );

        const Trash2Icon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const SearchIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const UploadIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const SamCareerCoach = () => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [jobCards, setJobCards] = useState([]);
            const [savedJobs, setSavedJobs] = useState([]);
            const [showSavedJobs, setShowSavedJobs] = useState(false);
            const [isSearchingJobs, setIsSearchingJobs] = useState(false);
            const [isUploadingCV, setIsUploadingCV] = useState(false);
            const messagesEndRef = useRef(null);
            const fileInputRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, jobCards]);

            useEffect(() => {
                const greeting = getGreeting();
                setMessages([{
                    role: 'assistant',
                    content: greeting
                }]);
            }, []);

            const getGreeting = () => {
                const hour = new Date().getHours();
                let timeOfDay;
                if (hour < 12) timeOfDay = 'Morgen';
                else if (hour < 18) timeOfDay = 'Mittag';
                else timeOfDay = 'Abend';

                return `Guten ${timeOfDay}, sch√∂n, dass du da bist. Mein Name ist Sam. Ich bin hier, um dich dabei zu unterst√ºtzen, deinen n√§chsten Karriereschritt zu finden.

Damit dieser Schritt genau zu dir passt, stelle ich dir gleich ein paar Fragen. Je offener und pr√§ziser du sie beantwortest, desto besser wird das Ergebnis. Keine Sorge! Deine Daten sind bei mir sicher. Sie sind von niemandem sonst einsehbar.

In welcher beruflichen Situation befindest du dich gerade?`;
            };

            const getSystemPrompt = () => {
                return `Du bist Sam, ein fortschrittlicher KI-Karriere-Coach und Recruiting-Experte.

WICHTIG: Du hast Zugriff auf die Arbeitsagentur Jobb√∂rse - die GR√ñ√üTE deutsche Stellendatenbank mit INTELLIGENTER GESTAFFELTER SUCHE!

JOB-SUCHE BEST PRACTICES:
- Verwende SPEZIFISCHE Suchbegriffe basierend auf dem Profil: "Operations Director", "Head of Marketing", etc.
- Location: IMMER eine konkrete deutsche Stadt angeben ("Berlin", "M√ºnchen", "Hamburg", "Hannover")
- NIEMALS location leer lassen - die API verlangt konkrete St√§dte!
- Das System erweitert automatisch: spezifisch ‚Üí breit, lokal ‚Üí deutschlandweit

PROAKTIVES VERHALTEN:
- Starte mit psychografisch pr√§zisen Queries - das System macht sie automatisch breiter wenn n√∂tig
- Sage dem Nutzer NICHT, dass du suchst oder was du suchst
- Das System probiert automatisch Query-Varianten und verschiedene Locations
- Der Nutzer sieht nur erfolgreiche Ergebnisse

CV-UPLOAD: Zeige NIEMALS rohe CV-Daten, nur pers√∂nliche Antworten.

====================================
KRITISCHE REGEL: TRIGGER_SEARCH vs JOB_CARD
====================================

Es gibt NUR ZWEI Situationen wo du diese Tags verwendest:

1Ô∏è‚É£ TRIGGER_SEARCH - VERWENDE NUR WENN:
   ‚úÖ Du bereit bist eine NEUE Job-Suche zu starten
   ‚úÖ User sagt "Speichern & weiter" oder "Zeige mir weitere Stellen"
   ‚úÖ User lehnt einen Job ab
   ‚úÖ Du NOCH KEINE Jobs zur Analyse bekommen hast

   ‚ùå NIEMALS verwenden wenn du bereits Jobs zur Analyse bekommen hast!

2Ô∏è‚É£ JOB_CARD - VERWENDE NUR WENN:
   ‚úÖ Du hast gerade Jobs ZUR ANALYSE bekommen (System sendet dir 5 Jobs)
   ‚úÖ Du sollst den BESTEN Job empfehlen
   ‚úÖ Du siehst einen Job-Titel, Firma, Beschreibung in der Nachricht
   
   ‚ùå NIEMALS zusammen mit TRIGGER_SEARCH verwenden!

====================================

WENN DU JOBS ZUR ANALYSE BEKOMMST:
- Das System sendet dir 5 Jobs mit: Titel, Firma, Ort, Beschreibung
- Du MUSST dann SOFORT eine JOB_CARD erstellen
- Bewerte ALLE 5 Jobs intern (50% psychografisch!)
- W√§hle den BESTEN aus
- Erstelle NUR eine JOB_CARD - KEINEN TRIGGER_SEARCH!

Format:

[Deine pers√∂nliche Analyse warum dieser Job passt]

[JOB_CARD:{
  "title": "Job Titel",
  "company": "Firma", 
  "location": "Ort",
  "salary": "Gehalt",
  "description": "2-3 S√§tze",
  "fitScore": 85,
  "pros": ["Passt weil..."],
  "cons": ["Beachte..."],
  "applyUrl": "https://..."
}]

WENN USER "SPEICHERN & WEITER" SAGT:
- User will mehr Optionen sehen
- Erstelle NEUEN TRIGGER_SEARCH (KEINE JOB_CARD!)
- Query kann √§hnlich sein oder leicht variieren

Format:

Super! Ich schaue nach weiteren Positionen. üîç

[TRIGGER_SEARCH:{
  "query": "...",
  "location": "..."
}]

====================================

GESPR√ÑCHSF√úHRUNG:
- Stelle NUR EINE Frage pro Nachricht
- Nutze Emojis angemessen
- Frage gezielt nach f√ºr vollst√§ndiges Profil

PROFILERSTELLUNG (50% des Fit-Scores!):
1. Werte & Motivatoren
2. Arbeitspsychologie  
3. Umfeld-Pr√§ferenzen

DREI HAUPTFRAGEN:
1. Berufliche Situation?
2. Berufliche Entwicklung (3-5 Jahre)?
3. F√§higkeiten & Erfahrungen? (CV-Upload m√∂glich)

JOBEMPFEHLUNGEN:
- IMMER nur EINEN Job pro Nachricht
- Erkl√§re psychografischen Fit ausf√ºhrlich
- Warte auf Feedback
- Du h√∂rst NUR auf wenn User EXPLIZIT stoppt`;
            };

            const parseJobCard = (text) => {
                const jobMatch = text.match(/\[JOB_CARD:\s*(\{[\s\S]*?\})\s*\]/);
                if (!jobMatch) return null;

                try {
                    const jsonString = jobMatch[1].trim();
                    const jobData = JSON.parse(jsonString);
                    const cleanText = text.replace(/\[JOB_CARD:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                    return { jobData, cleanText };
                } catch (e) {
                    console.error('‚ùå Error parsing job card:', e);
                    return null;
                }
            };

            // ZENTRALE FUNKTION: Verarbeitet Sam's Response (mit oder ohne TRIGGER_SEARCH)
            const processSamResponse = async (assistantMessage, updatedMessages) => {
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üì• DEBUG: processSamResponse called');
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üìù FULL SAM RESPONSE:');
                console.log(assistantMessage);
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                
                // SCHRITT 1: Check f√ºr TRIGGER_SEARCH (Priorit√§t!)
                const searchTrigger = assistantMessage.match(/\[TRIGGER_SEARCH:\s*(\{[\s\S]*?\})\s*\]/);
                
                console.log('üîç DEBUG: Checking for TRIGGER_SEARCH...');
                console.log('   Found:', searchTrigger ? 'YES ‚úÖ' : 'NO ‚ùå');
                
                if (searchTrigger) {
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üîç DEBUG: TRIGGER_SEARCH detected!');
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üìã Raw JSON string:', searchTrigger[1]);
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    
                    try {
                        const searchParams = JSON.parse(searchTrigger[1]);
                        console.log('‚úÖ Parsed successfully:', searchParams);
                        
                        // Entferne TRIGGER_SEARCH aus Text
                        const cleanMessage = assistantMessage.replace(/\[TRIGGER_SEARCH:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                        
                        console.log('üìù Text BEFORE TRIGGER_SEARCH:');
                        console.log(cleanMessage || '(empty)');
                        console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                        
                        // Zeige Sam's Nachricht (ohne TRIGGER_SEARCH)
                        if (cleanMessage) {
                            console.log('üí¨ Adding clean message to chat');
                            setMessages(prev => [...prev, { role: 'assistant', content: cleanMessage }]);
                        }
                        
                        setIsLoading(false);
                        
                        console.log('üöÄ Starting job search with query:', searchParams.query, 'location:', searchParams.location);
                        
                        // Starte Job-Suche
                        await searchJobs(searchParams.query, searchParams.location, updatedMessages, 0, new Set());
                        return true; // Verarbeitet!
                        
                    } catch (e) {
                        console.error('‚ùå Error parsing TRIGGER_SEARCH JSON:', e);
                        console.error('Raw JSON:', searchTrigger[1]);
                        
                        // WICHTIG: Auch bei Parse-Error den TRIGGER_SEARCH entfernen und cleaned message anzeigen!
                        const cleanMessage = assistantMessage.replace(/\[TRIGGER_SEARCH:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                        if (cleanMessage) {
                            setMessages(prev => [...prev, { role: 'assistant', content: cleanMessage }]);
                        }
                        
                        // Zeige Fehlermeldung
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: 'Entschuldige, da gab es ein technisches Problem. Lass uns manuell weitersuchen - welche Art von Position interessiert dich am meisten? ü§î'
                        }]);
                        
                        setIsLoading(false);
                        return true; // Verhindere dass der rohe TRIGGER_SEARCH angezeigt wird!
                    }
                }
                
                // SCHRITT 2: Check f√ºr JOB_CARD
                console.log('üîç DEBUG: Checking for JOB_CARD...');
                const parsed = parseJobCard(assistantMessage);
                console.log('   Found:', parsed ? 'YES ‚úÖ' : 'NO ‚ùå');
                
                if (parsed) {
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üìã DEBUG: JOB_CARD detected and parsed!');
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üíº Job:', parsed.jobData.title);
                    console.log('üè¢ Company:', parsed.jobData.company);
                    console.log('üìç Location:', parsed.jobData.location);
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    
                    setJobCards(prev => [...prev, { ...parsed.jobData, id: Date.now() }]);
                    if (parsed.cleanText) {
                        console.log('üí¨ Adding clean text before card:', parsed.cleanText.substring(0, 100) + '...');
                        setMessages(prev => [...prev, { role: 'assistant', content: parsed.cleanText }]);
                    }
                    return true;
                }
                
                // SCHRITT 3: Normaler Text
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üí¨ DEBUG: Normal message (no TRIGGER_SEARCH or JOB_CARD)');
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üìù Message content:', assistantMessage.substring(0, 200) + '...');
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                
                setMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
                return true;
            };

            // ========================================
            // NEUE INTELLIGENTE GESTAFFELTE JOB-SUCHE
            // ========================================
            
            // Generiert Query-Varianten: spezifisch ‚Üí breit
            const generateQueryVariants = (query) => {
                const variants = [query];
                const words = query.split(' ').filter(w => w.length > 2);
                
                // Extrahiere Kernbegriffe und erstelle breitere Varianten
                if (words.length >= 3) {
                    // Z.B. "Operations Director Manager" ‚Üí "Operations Director" ‚Üí "Operations Manager" ‚Üí "Director" ‚Üí "Manager"
                    variants.push(words.slice(0, 2).join(' '));
                    variants.push(words[0] + ' ' + words[words.length - 1]);
                    variants.push(words[0]);
                    variants.push(words[words.length - 1]);
                } else if (words.length === 2) {
                    // Z.B. "Operations Director" ‚Üí "Operations Manager" ‚Üí "Operations" ‚Üí "Director"
                    variants.push(words[0] + ' Manager');
                    variants.push(words[0]);
                    variants.push(words[1]);
                } else if (words.length === 1) {
                    // Single word - add "Manager" variant
                    variants.push(words[0] + ' Manager');
                }
                
                // Remove duplicates und behalte Reihenfolge
                const unique = [...new Set(variants)];
                console.log('üìä Query variants:', unique);
                return unique;
            };
            
            // Generiert Location-Tiers: lokal ‚Üí regional ‚Üí √ºberregional
            const generateLocationTiers = (userRegion = 'Hannover') => {
                const tiers = [
                    // Runde 1: Nutzer-Region lokal
                    { location: userRegion, radius: 50, label: 'Lokal' },
                    { location: userRegion, radius: 100, label: 'Regional' },
                    
                    // Runde 2: Gro√üe St√§dte f√ºr deutschlandweite Abdeckung
                    { location: 'Berlin', radius: 100, label: 'Berlin Region' },
                    { location: 'M√ºnchen', radius: 100, label: 'M√ºnchen Region' },
                    { location: 'Hamburg', radius: 100, label: 'Hamburg Region' },
                    
                    // Runde 3: Erweiterte Suche
                    { location: 'Frankfurt', radius: 150, label: 'Frankfurt erweitert' },
                    { location: 'K√∂ln', radius: 150, label: 'K√∂ln erweitert' },
                    
                    // Runde 4: Garantierter Fallback
                    { location: 'Berlin', radius: 200, label: 'Berlin deutschlandweit' }
                ];
                
                console.log('üìç Location tiers:', tiers);
                return tiers;
            };
            
            // Einzelner API-Call zur Arbeitsagentur
            const searchJobsAPI = async (query, location, radius) => {
                const response = await fetch('/.netlify/functions/search-jobs-arbeitsagentur', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        location: location,
                        radius: radius,
                        size: 25
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                return await response.json();
            };
            
            // Hauptfunktion: Intelligente gestaffelte Suche
            const searchJobs = async (query, location, currentMessages, retryCount = 0, triedSet = new Set()) => {
                console.log('üéØ Starting intelligent tiered search for:', query);
                
                setIsSearchingJobs(true);
                
                try {
                    // Generiere Query-Varianten und Location-Tiers
                    const queryVariants = generateQueryVariants(query);
                    const userRegion = location || 'Hannover'; // Default zu Hannover wenn keine Location
                    const locationTiers = generateLocationTiers(userRegion);
                    
                    let attemptNumber = 0;
                    let foundJobs = null;
                    
                    // Durchlaufe alle Kombinationen: Query-Varianten √ó Location-Tiers
                    for (const queryVariant of queryVariants) {
                        if (foundJobs) break; // Stop wenn Jobs gefunden
                        
                        for (const locationTier of locationTiers) {
                            attemptNumber++;
                            
                            console.log(`üîç Attempt ${attemptNumber}: "${queryVariant}" in ${locationTier.location} (${locationTier.radius}km) [${locationTier.label}]`);
                            
                            try {
                                const data = await searchJobsAPI(queryVariant, locationTier.location, locationTier.radius);
                                
                                console.log(`üìä Result: ${data.total || 0} jobs found`);
                                
                                if (data.jobs && data.jobs.length > 0) {
                                    console.log(`üéâ SUCCESS! Found ${data.jobs.length} jobs!`);
                                    foundJobs = {
                                        jobs: data.jobs,
                                        query: queryVariant,
                                        location: locationTier.location
                                    };
                                    break; // Erfolg - stop die innere Schleife
                                } else {
                                    console.log('üì≠ No jobs, trying next combination...');
                                }
                                
                            } catch (error) {
                                console.error(`‚ùå Error in attempt ${attemptNumber}:`, error);
                                // Continue mit n√§chster Kombination
                            }
                        }
                    }
                    
                    // Check ob Jobs gefunden wurden
                    if (!foundJobs) {
                        console.error('‚ùå All combinations exhausted - no jobs found');
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: `Ich habe sehr gr√ºndlich gesucht, aber leider keine passenden Stellen gefunden. Lass uns gemeinsam √ºberlegen: K√∂nnten wir das Suchprofil etwas anpassen? Vielleicht verwandte Rollen oder andere Branchen einbeziehen? ü§î`
                        }]);
                        setIsSearchingJobs(false);
                        return null;
                    }
                    
                    // Jobs gefunden! Sende an Sam zur Bewertung
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üì§ DEBUG: Sending jobs to Sam for ANALYSIS');
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log(`   Jobs found: ${foundJobs.jobs.length}`);
                    console.log(`   Query: "${foundJobs.query}"`);
                    console.log(`   Location: "${foundJobs.location}"`);
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    
                    const jobsContext = `[SYSTEM: JOB-ANALYSE-MODUS]

Hier sind ${foundJobs.jobs.length} Jobs von der Bundesagentur f√ºr "${foundJobs.query}" in "${foundJobs.location}":

${foundJobs.jobs.slice(0, 5).map((job, i) => `
Job ${i + 1}:
- Titel: ${job.title}
- Firma: ${job.company}
- Ort: ${job.location}
- Beschreibung: ${job.description}
- Link: ${job.url}
`).join('\n')}

DEINE AUFGABE:
1. Bewerte ALLE 5 Jobs intern (50% psychografisch, 30% Skills, 20% Umfeld)
2. W√§hle den BESTEN Job basierend auf dem Pers√∂nlichkeitsprofil
3. Erstelle EINE JOB_CARD f√ºr diesen Job

WICHTIG: 
‚úÖ Erstelle NUR eine JOB_CARD
‚ùå KEINEN TRIGGER_SEARCH verwenden!
‚ùå Dieser Prompt bedeutet NICHT "suche weitere Jobs"
‚ùå Du musst NUR den besten der 5 gegebenen Jobs empfehlen

Format:
[Deine pers√∂nliche Analyse des Jobs - 2-3 S√§tze]

[JOB_CARD:{...}]

Begr√ºnde ausf√ºhrlich warum dieser Job zum Pers√∂nlichkeitsprofil passt.`;

                    const updatedMessages = [...currentMessages, {
                        role: 'user',
                        content: jobsContext
                    }];

                    const samResponse = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });

                    const samData = await samResponse.json();
                    const assistantMessage = samData.content[0].text;

                    const parsed = parseJobCard(assistantMessage);
                    if (parsed) {
                        setJobCards(prev => [...prev, { ...parsed.jobData, id: Date.now() }]);
                        if (parsed.cleanText) {
                            setMessages(prev => [...prev, { role: 'assistant', content: parsed.cleanText }]);
                        }
                    } else {
                        setMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
                    }
                    
                    setIsSearchingJobs(false);
                    return foundJobs.jobs;

                } catch (error) {
                    console.error('‚ùå Critical search error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Technisches Problem bei der Suche. Lass uns es nochmal versuchen! üîß'
                    }]);
                    setIsSearchingJobs(false);
                    return null;
                }
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                setIsUploadingCV(true);
                console.log('üìÑ CV upload started');
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const base64Data = e.target.result.split(',')[1];
                        
                        const response = await fetch('/.netlify/functions/parse-cv', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                fileData: base64Data,
                                fileName: file.name,
                                fileType: file.type
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error('Upload fehlgeschlagen');
                        }
                        
                        const data = await response.json();
                        const fileMessage = `[SYSTEM: Der Nutzer hat seinen Lebenslauf hochgeladen. Analysiere und antworte pers√∂nlich. Zeige NICHT die rohen Daten.]\n\n${data.text}`;
                        
                        const updatedMessages = [...messages, { role: 'user', content: fileMessage }];
                        setIsUploadingCV(false);
                        setIsLoading(true);

                        const samResponse = await fetch('/.netlify/functions/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                messages: updatedMessages,
                                system: getSystemPrompt()
                            })
                        });

                        const samData = await samResponse.json();
                        const assistantMessage = samData.content[0].text;

                        // WICHTIG: Nutze zentrale Verarbeitungsfunktion!
                        // updatedMessages muss die Assistant-Message enthalten f√ºr searchJobs!
                        const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                        await processSamResponse(assistantMessage, messagesWithResponse);
                        setIsLoading(false);
                        
                    } catch (error) {
                        console.error('‚ùå CV upload error:', error);
                        setMessages([...messages, {
                            role: 'assistant',
                            content: 'Fehler beim Verarbeiten. Bitte nochmal versuchen. üîß'
                        }]);
                        setIsUploadingCV(false);
                        setIsLoading(false);
                    }
                };
                reader.readAsDataURL(file);
            };

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;

                const userMessage = { role: 'user', content: input };
                const updatedMessages = [...messages, userMessage];
                setMessages(updatedMessages);
                setInput('');
                setIsLoading(true);

                try {
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;

                    // Nutze zentrale Verarbeitungsfunktion!
                    // updatedMessages muss die Assistant-Message enthalten f√ºr searchJobs!
                    const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                    await processSamResponse(assistantMessage, messagesWithResponse);

                } catch (error) {
                    console.error('‚ùå Error:', error);
                    setMessages([...updatedMessages, { 
                        role: 'assistant', 
                        content: 'Technischer Fehler. Bitte nochmal versuchen.' 
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleJobAction = async (jobId, action) => {
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('üé¨ DEBUG: handleJobAction called');
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                console.log('   Action:', action);
                console.log('   Job ID:', jobId);
                console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                
                const job = jobCards.find(j => j.id === jobId);
                if (!job) return;

                let userResponse = '';
                if (action === 'apply') {
                    userResponse = `Ich m√∂chte mich f√ºr "${job.title}" bewerben.`;
                    if (job.applyUrl) window.open(job.applyUrl, '_blank');
                } else if (action === 'save') {
                    console.log('üíæ DEBUG: User clicked SAVE button - expecting TRIGGER_SEARCH in response!');
                    setSavedJobs(prev => {
                        if (prev.find(j => j.id === jobId)) return prev;
                        return [...prev, job];
                    });
                    userResponse = `"${job.title}" gespeichert. Zeige mir weitere Stellen.`;
                } else if (action === 'reject') {
                    userResponse = `"${job.title}" passt nicht.`;
                }

                console.log('üì§ DEBUG: Sending to Sam:', userResponse);
                
                setJobCards(prev => prev.filter(j => j.id !== jobId));

                const userMessage = { role: 'user', content: userResponse };
                const updatedMessages = [...messages, userMessage];
                // Zeige user message sofort
                setMessages(updatedMessages);
                setIsLoading(true);

                try {
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    console.log('üì® DEBUG: Sam response after handleJobAction:');
                    console.log('   Context: After user clicked "' + action + '"');
                    console.log('   Expected: TRIGGER_SEARCH (if save/reject) or normal text (if apply)');
                    console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
                    
                    // Nutze zentrale Verarbeitungsfunktion!
                    // WICHTIG: processSamResponse f√ºgt die assistant message hinzu - wir tun das NICHT hier!
                    const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                    await processSamResponse(assistantMessage, messagesWithResponse);

                } catch (error) {
                    console.error('‚ùå Error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Fehler. Lass uns weitermachen! üîß'
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div style={{
                    maxWidth: '900px',
                    margin: '0 auto',
                    height: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    backgroundColor: '#f8f9fa'
                }}>
                    <div style={{
                        backgroundColor: '#2563eb',
                        color: 'white',
                        padding: '20px',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <div style={{ textAlign: 'left' }}>
                            <h1 style={{ margin: 0, fontSize: '24px', fontWeight: '600' }}>
                                üíº Sam - Dein Karriere-Coach
                            </h1>
                            <p style={{ margin: '5px 0 0 0', fontSize: '14px', opacity: 0.9 }}>
                                Powered by Bundesagentur f√ºr Arbeit
                            </p>
                        </div>
                        
                        {savedJobs.length > 0 && (
                            <button
                                onClick={() => setShowSavedJobs(true)}
                                style={{
                                    backgroundColor: 'rgba(255,255,255,0.2)',
                                    border: '2px solid white',
                                    color: 'white',
                                    padding: '10px 20px',
                                    borderRadius: '8px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                üìã Gespeicherte Jobs ({savedJobs.length})
                            </button>
                        )}
                    </div>

                    <div style={{
                        flex: 1,
                        overflowY: 'auto',
                        padding: '20px',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '16px'
                    }}>
                        {messages.map((message, index) => (
                            <div
                                key={index}
                                style={{
                                    display: 'flex',
                                    justifyContent: message.role === 'user' ? 'flex-end' : 'flex-start'
                                }}
                            >
                                <div style={{
                                    maxWidth: '70%',
                                    padding: '12px 16px',
                                    borderRadius: '12px',
                                    backgroundColor: message.role === 'user' ? '#2563eb' : 'white',
                                    color: message.role === 'user' ? 'white' : '#1f2937',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    whiteSpace: 'pre-wrap',
                                    lineHeight: '1.5'
                                }}>
                                    {message.content}
                                </div>
                            </div>
                        ))}

                        {jobCards.map((job) => (
                            <div key={job.id} style={{
                                backgroundColor: 'white',
                                borderRadius: '16px',
                                padding: '24px',
                                boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                                border: '2px solid #e5e7eb',
                                maxWidth: '85%',
                                margin: '0 auto',
                                width: '100%'
                            }}>
                                <div style={{
                                    display: 'inline-block',
                                    backgroundColor: job.fitScore >= 80 ? '#10b981' : job.fitScore >= 60 ? '#f59e0b' : '#ef4444',
                                    color: 'white',
                                    padding: '4px 12px',
                                    borderRadius: '20px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    marginBottom: '12px'
                                }}>
                                    {job.fitScore}% Match
                                </div>

                                <h3 style={{ margin: '0 0 8px 0', fontSize: '20px', fontWeight: '600', color: '#1f2937' }}>
                                    {job.title}
                                </h3>

                                <div style={{ display: 'flex', gap: '16px', fontSize: '14px', color: '#6b7280', marginBottom: '16px', flexWrap: 'wrap' }}>
                                    <span>üè¢ {job.company}</span>
                                    <span>üìç {job.location}</span>
                                    {job.salary && <span>üí∞ {job.salary}</span>}
                                </div>

                                <p style={{ fontSize: '15px', lineHeight: '1.6', color: '#374151', marginBottom: '16px' }}>
                                    {job.description}
                                </p>

                                {job.pros && job.pros.length > 0 && (
                                    <div style={{ marginBottom: '12px' }}>
                                        <div style={{ fontSize: '14px', fontWeight: '600', color: '#10b981', marginBottom: '6px' }}>
                                            ‚úÖ Was passt:
                                        </div>
                                        <ul style={{ margin: 0, paddingLeft: '20px', fontSize: '14px', color: '#374151' }}>
                                            {job.pros.map((pro, i) => (
                                                <li key={i} style={{ marginBottom: '4px' }}>{pro}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                {job.cons && job.cons.length > 0 && (
                                    <div style={{ marginBottom: '20px' }}>
                                        <div style={{ fontSize: '14px', fontWeight: '600', color: '#f59e0b', marginBottom: '6px' }}>
                                            ‚ö†Ô∏è Beachte:
                                        </div>
                                        <ul style={{ margin: 0, paddingLeft: '20px', fontSize: '14px', color: '#374151' }}>
                                            {job.cons.map((con, i) => (
                                                <li key={i} style={{ marginBottom: '4px' }}>{con}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                <div style={{ display: 'flex', gap: '12px', marginTop: '20px', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={() => handleJobAction(job.id, 'apply')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#2563eb',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <CheckCircleIcon />
                                        Bewerben
                                    </button>
                                    
                                    <button
                                        onClick={() => handleJobAction(job.id, 'save')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#10b981',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <BookmarkPlusIcon />
                                        Speichern & weiter
                                    </button>
                                    
                                    <button
                                        onClick={() => handleJobAction(job.id, 'reject')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#ef4444',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <Trash2Icon />
                                        Verwerfen
                                    </button>
                                </div>
                            </div>
                        ))}

                        {(isLoading || isSearchingJobs || isUploadingCV) && (
                            <div style={{ display: 'flex', justifyContent: 'flex-start' }}>
                                <div style={{
                                    padding: '12px 16px',
                                    borderRadius: '12px',
                                    backgroundColor: 'white',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    display: 'flex',
                                    gap: '8px',
                                    alignItems: 'center'
                                }}>
                                    {isSearchingJobs ? (
                                        <>
                                            <SearchIcon />
                                            <span style={{ fontSize: '14px', color: '#6b7280' }}>
                                                Durchsuche Jobb√∂rse...
                                            </span>
                                        </>
                                    ) : isUploadingCV ? (
                                        <>
                                            <UploadIcon />
                                            <span style={{ fontSize: '14px', color: '#6b7280' }}>
                                                Verarbeite Lebenslauf...
                                            </span>
                                        </>
                                    ) : (
                                        <>
                                            <div className="bounce-dot" style={{ animationDelay: '0s' }} />
                                            <div className="bounce-dot" style={{ animationDelay: '0.16s' }} />
                                            <div className="bounce-dot" style={{ animationDelay: '0.32s' }} />
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        <div ref={messagesEndRef} />
                    </div>

                    {/* Saved Jobs Modal */}
                    {showSavedJobs && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            backgroundColor: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            justifyContent: 'center',
                            alignItems: 'center',
                            zIndex: 1000,
                            padding: '20px'
                        }}
                        onClick={() => setShowSavedJobs(false)}
                        >
                            <div style={{
                                backgroundColor: 'white',
                                borderRadius: '16px',
                                maxWidth: '900px',
                                width: '100%',
                                maxHeight: '90vh',
                                display: 'flex',
                                flexDirection: 'column',
                                boxShadow: '0 20px 50px rgba(0,0,0,0.3)'
                            }}
                            onClick={(e) => e.stopPropagation()}
                            >
                                <div style={{
                                    padding: '24px',
                                    borderBottom: '1px solid #e5e7eb',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <h2 style={{ margin: 0, fontSize: '24px', fontWeight: '600', color: '#1f2937' }}>
                                        üìã Gespeicherte Jobs ({savedJobs.length})
                                    </h2>
                                    <button
                                        onClick={() => setShowSavedJobs(false)}
                                        style={{
                                            backgroundColor: 'transparent',
                                            border: 'none',
                                            fontSize: '24px',
                                            cursor: 'pointer',
                                            color: '#6b7280',
                                            padding: '4px 8px'
                                        }}
                                    >
                                        ‚úï
                                    </button>
                                </div>
                                
                                <div style={{
                                    flex: 1,
                                    overflowY: 'auto',
                                    padding: '20px'
                                }}>
                                    {savedJobs.length === 0 ? (
                                        <div style={{
                                            textAlign: 'center',
                                            padding: '60px 20px',
                                            color: '#6b7280'
                                        }}>
                                            <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìã</div>
                                            <p style={{ fontSize: '18px', margin: 0 }}>Noch keine Jobs gespeichert</p>
                                        </div>
                                    ) : (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                            {[...savedJobs].sort((a, b) => b.fitScore - a.fitScore).map((job) => (
                                                <div key={job.id} style={{
                                                    backgroundColor: '#f9fafb',
                                                    borderRadius: '12px',
                                                    padding: '20px',
                                                    border: '2px solid #e5e7eb'
                                                }}>
                                                    <div style={{
                                                        display: 'inline-block',
                                                        backgroundColor: job.fitScore >= 80 ? '#10b981' : job.fitScore >= 60 ? '#f59e0b' : '#ef4444',
                                                        color: 'white',
                                                        padding: '4px 12px',
                                                        borderRadius: '20px',
                                                        fontSize: '14px',
                                                        fontWeight: '600',
                                                        marginBottom: '12px'
                                                    }}>
                                                        {job.fitScore}% Match
                                                    </div>

                                                    <h3 style={{ margin: '0 0 8px 0', fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>
                                                        {job.title}
                                                    </h3>

                                                    <div style={{ display: 'flex', gap: '16px', fontSize: '14px', color: '#6b7280', marginBottom: '12px', flexWrap: 'wrap' }}>
                                                        <span>üè¢ {job.company}</span>
                                                        <span>üìç {job.location}</span>
                                                        {job.salary && <span>üí∞ {job.salary}</span>}
                                                    </div>

                                                    <p style={{ fontSize: '14px', lineHeight: '1.6', color: '#374151', marginBottom: '16px' }}>
                                                        {job.description}
                                                    </p>

                                                    <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                                                        <button
                                                            onClick={() => {
                                                                if (job.applyUrl) window.open(job.applyUrl, '_blank');
                                                            }}
                                                            style={{
                                                                flex: '1',
                                                                minWidth: '120px',
                                                                padding: '10px 16px',
                                                                backgroundColor: '#2563eb',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '8px'
                                                            }}
                                                        >
                                                            <CheckCircleIcon />
                                                            Bewerben
                                                        </button>
                                                        
                                                        <button
                                                            onClick={() => {
                                                                setSavedJobs(prev => prev.filter(j => j.id !== job.id));
                                                            }}
                                                            style={{
                                                                flex: '1',
                                                                minWidth: '120px',
                                                                padding: '10px 16px',
                                                                backgroundColor: '#ef4444',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '8px'
                                                            }}
                                                        >
                                                            <Trash2Icon />
                                                            Entfernen
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div style={{
                        padding: '20px',
                        backgroundColor: 'white',
                        borderTop: '1px solid #e5e7eb',
                        boxShadow: '0 -2px 4px rgba(0,0,0,0.05)'
                    }}>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'flex-end' }}>
                            <input
                                type="file"
                                ref={fileInputRef}
                                onChange={handleFileUpload}
                                accept=".txt,.pdf,.doc,.docx"
                                style={{ display: 'none' }}
                            />
                            
                            <button
                                onClick={() => fileInputRef.current?.click()}
                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                title="Lebenslauf hochladen"
                                style={{
                                    padding: '12px',
                                    backgroundColor: '#f3f4f6',
                                    border: '1px solid #d1d5db',
                                    borderRadius: '8px',
                                    cursor: (isLoading || isSearchingJobs || isUploadingCV) ? 'not-allowed' : 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    opacity: (isLoading || isSearchingJobs || isUploadingCV) ? 0.5 : 1
                                }}
                            >
                                <FileUpIcon />
                            </button>

                            <textarea
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && !e.shiftKey) {
                                        e.preventDefault();
                                        handleSend();
                                    }
                                }}
                                placeholder="Schreibe deine Antwort..."
                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                style={{
                                    flex: 1,
                                    padding: '12px 16px',
                                    borderRadius: '8px',
                                    border: '1px solid #d1d5db',
                                    fontSize: '15px',
                                    resize: 'none',
                                    minHeight: '48px',
                                    maxHeight: '120px',
                                    fontFamily: 'inherit',
                                    outline: 'none'
                                }}
                                rows={1}
                            />

                            <button
                                onClick={handleSend}
                                disabled={!input.trim() || isLoading || isSearchingJobs || isUploadingCV}
                                style={{
                                    padding: '12px 24px',
                                    backgroundColor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? '#2563eb' : '#d1d5db',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '15px',
                                    fontWeight: '600',
                                    cursor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? 'pointer' : 'not-allowed',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                <SendIcon />
                                Senden
                            </button>
                        </div>
                        
                        <div style={{ marginTop: '12px', textAlign: 'center', fontSize: '12px', color: '#6b7280' }}>
                            Powered by Claude ¬∑ Jobs von Bundesagentur f√ºr Arbeit
                        </div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<SamCareerCoach />);
    </script>

    <style>
        .bounce-dot {
            width: 8px;
            height: 8px;
            borderRadius: 50%;
            backgroundColor: #2563eb;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1);
            }
        }
    </style>
</body>
</html>
