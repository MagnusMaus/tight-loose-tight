<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TabiCoach - Jobs, die zu dir passen</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #ffffff;
        }
        
        #root {
            width: 100%;
        }

        .bounce-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #2563eb;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1);
            }
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Icons
        const SendIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const FileUpIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const BookmarkPlusIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                <line x1="12" y1="7" x2="12" y2="13"></line>
                <line x1="9" y1="10" x2="15" y2="10"></line>
            </svg>
        );

        const Trash2Icon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const SearchIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const BrainIcon = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ec4899" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path>
                <path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path>
            </svg>
        );

        const DiamondIcon = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                <path d="M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z"></path>
            </svg>
        );

        const SparklesIcon = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
            </svg>
        );

        const SamCareerCoach = () => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [jobCards, setJobCards] = useState([]);
            const [savedJobs, setSavedJobs] = useState([]);
            const [showSavedJobs, setShowSavedJobs] = useState(false);
            const [isSearchingJobs, setIsSearchingJobs] = useState(false);
            const [isUploadingCV, setIsUploadingCV] = useState(false);
            const [shownJobUrls, setShownJobUrls] = useState(new Set());
            const messagesEndRef = useRef(null);
            const fileInputRef = useRef(null);
            const chatSectionRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            const scrollToChat = () => {
                chatSectionRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, jobCards]);

            useEffect(() => {
                const greeting = getGreeting();
                setMessages([{
                    role: 'assistant',
                    content: greeting
                }]);
            }, []);

            const getGreeting = () => {
                return `Schön, dass du da bist. Ich bin Sam.

Ich finde Jobs, die nicht nur zu deinem Lebenslauf passen, sondern zu dem, wer du wirklich bist.

Deine Antworten bleiben vertraulich. Niemand außer dir sieht sie.

In welcher Situation bist du gerade?`;
            };

            const getSystemPrompt = () => {
                return `Du bist Sam, ein fortschrittlicher KI-Karriere-Coach und Recruiting-Experte.

WICHTIG: Du hast Zugriff auf die Arbeitsagentur Jobbörse - die GRÖßTE deutsche Stellendatenbank mit INTELLIGENTER GESTAFFELTER SUCHE!

JOB-SUCHE BEST PRACTICES:
- Verwende SPEZIFISCHE Suchbegriffe basierend auf dem Profil: "Operations Director", "Head of Marketing", etc.
- Location: IMMER eine konkrete deutsche Stadt angeben ("Berlin", "München", "Hamburg", "Hannover")
- NIEMALS location leer lassen - die API verlangt konkrete Städte!
- Das System erweitert automatisch: spezifisch → breit, lokal → deutschlandweit

PROAKTIVES VERHALTEN:
- Starte mit psychografisch präzisen Queries - das System macht sie automatisch breiter wenn nötig
- Sage dem Nutzer NICHT, dass du suchst oder was du suchst
- Das System probiert automatisch Query-Varianten und verschiedene Locations
- Der Nutzer sieht nur erfolgreiche Ergebnisse

CV-UPLOAD: Zeige NIEMALS rohe CV-Daten, nur persönliche Antworten.

====================================
KRITISCHE REGEL: TRIGGER_SEARCH vs JOB_CARD
====================================

Es gibt NUR ZWEI Situationen wo du diese Tags verwendest:

1️⃣ TRIGGER_SEARCH - VERWENDE NUR WENN:
   ✅ Du bereit bist eine NEUE Job-Suche zu starten
   ✅ User sagt "Speichern & weiter" oder "Zeige mir weitere Stellen"
   ✅ User lehnt einen Job ab
   ✅ Du NOCH KEINE Jobs zur Analyse bekommen hast

   ❌ NIEMALS verwenden wenn du bereits Jobs zur Analyse bekommen hast!

2️⃣ JOB_CARD - VERWENDE NUR WENN:
   ✅ Du Jobs vom System bekommen hast (in <jobs_data>)
   ✅ Du sie JETZT präsentieren willst

   ❌ NIEMALS spekulativ verwenden ("Ich suche jetzt...")!

FORMAT:
<TRIGGER_SEARCH>
{
  "query": "Exact job title/keywords",
  "location": "Berlin",
  "radius": 100,
  "size": 25
}
</TRIGGER_SEARCH>

<JOB_CARD>
{
  "id": "job_ref_number",
  "title": "Job Title",
  "company": "Company Name",
  "location": "City",
  "description": "Brief why this fits",
  "url": "application_url"
}
</JOB_CARD>

KONVERSATIONS-FLOW:
1. Sammle ALLE wichtigen Infos (Position, Skills, Location, Gehaltsvorstellung, Kultur-Fit)
2. Wenn GENUG INFO → TRIGGER_SEARCH
3. WARTE auf <jobs_data> vom System
4. Analysiere Jobs psychografisch
5. Präsentiere via JOB_CARD

REAKTION auf User-Feedback:
- "Das interessiert mich" → Tiefer analysieren, warum es passt
- "Nicht mein Ding" → Warum? Nächste Suche anpassen
- "Speichern & weiter" → TRIGGER_SEARCH mit neuer Query

STIL:
- Persönlich, warm, empathisch
- Stelle gezielte Fragen
- Lies zwischen den Zeilen
- Sei proaktiv aber nicht aufdringlich

Dein Ziel: Den PERFEKTEN nächsten Schritt für diesen Menschen finden. 🎯`;
            };

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                setIsUploadingCV(true);

                try {
                    const reader = new FileReader();
                    reader.onload = async (event) => {
                        const base64Data = event.target.result.split(',')[1];

                        const response = await fetch('/.netlify/functions/parse-cv', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                fileData: base64Data,
                                fileName: file.name,
                                fileType: file.type
                            })
                        });

                        if (!response.ok) throw new Error('CV Upload fehlgeschlagen');

                        const data = await response.json();
                        
                        const cvMessage = {
                            role: 'user',
                            content: `[CV hochgeladen: ${file.name}]\n\n${data.text}`
                        };

                        setMessages(prev => [...prev, cvMessage]);
                        await sendToAPI([...messages, cvMessage]);
                    };

                    reader.readAsDataURL(file);
                } catch (error) {
                    console.error('Fehler beim CV-Upload:', error);
                    alert('Fehler beim Hochladen des Lebenslaufs. Bitte versuche es erneut.');
                } finally {
                    setIsUploadingCV(false);
                    e.target.value = '';
                }
            };

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;

                const userMessage = {
                    role: 'user',
                    content: input
                };

                setMessages(prev => [...prev, userMessage]);
                setInput('');
                
                await sendToAPI([...messages, userMessage]);
            };

            const sendToAPI = async (conversationHistory) => {
                setIsLoading(true);

                try {
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: conversationHistory,
                            system: getSystemPrompt()
                        })
                    });

                    if (!response.ok) throw new Error('API call failed');

                    const data = await response.json();
                    let assistantMessage = data.content[0].text;

                    const triggerMatch = assistantMessage.match(/<TRIGGER_SEARCH>([\s\S]*?)<\/TRIGGER_SEARCH>/);
                    if (triggerMatch) {
                        const searchParams = JSON.parse(triggerMatch[1].trim());
                        assistantMessage = assistantMessage.replace(/<TRIGGER_SEARCH>[\s\S]*?<\/TRIGGER_SEARCH>/, '').trim();
                        
                        if (assistantMessage) {
                            setMessages(prev => [...prev, {
                                role: 'assistant',
                                content: assistantMessage
                            }]);
                        }

                        await performJobSearch(searchParams, conversationHistory);
                        return;
                    }

                    const jobCardMatches = [...assistantMessage.matchAll(/<JOB_CARD>([\s\S]*?)<\/JOB_CARD>/g)];
                    
                    if (jobCardMatches.length > 0) {
                        const cleanMessage = assistantMessage.replace(/<JOB_CARD>[\s\S]*?<\/JOB_CARD>/g, '').trim();
                        
                        if (cleanMessage) {
                            setMessages(prev => [...prev, {
                                role: 'assistant',
                                content: cleanMessage
                            }]);
                        }

                        const newJobs = jobCardMatches
                            .map(match => {
                                try {
                                    return JSON.parse(match[1].trim());
                                } catch (e) {
                                    console.error('Error parsing job card:', e);
                                    return null;
                                }
                            })
                            .filter(job => job && !shownJobUrls.has(job.url));

                        if (newJobs.length > 0) {
                            setJobCards(prev => [...prev, ...newJobs]);
                            setShownJobUrls(prev => {
                                const newSet = new Set(prev);
                                newJobs.forEach(job => newSet.add(job.url));
                                return newSet;
                            });
                        }
                    } else {
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: assistantMessage
                        }]);
                    }

                } catch (error) {
                    console.error('Error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Entschuldigung, es gab einen technischen Fehler. Bitte versuche es erneut.'
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            const performJobSearch = async (searchParams, conversationHistory) => {
                setIsSearchingJobs(true);

                const searchStrategies = [
                    { query: searchParams.query, location: searchParams.location, radius: searchParams.radius || 100, size: 25 },
                    { query: searchParams.query, location: searchParams.location, radius: 150, size: 25 },
                    { query: searchParams.query.split(' ')[0], location: searchParams.location, radius: 100, size: 25 },
                    { query: searchParams.query, location: 'Berlin', radius: 50, size: 25 },
                    { query: searchParams.query, location: 'München', radius: 50, size: 25 },
                    { query: searchParams.query, location: 'Hamburg', radius: 50, size: 25 }
                ];

                let allJobs = [];

                for (const strategy of searchStrategies) {
                    try {
                        const response = await fetch('/.netlify/functions/search-jobs-arbeitsagentur', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(strategy)
                        });

                        if (response.ok) {
                            const data = await response.json();
                            if (data.jobs && data.jobs.length > 0) {
                                allJobs = [...allJobs, ...data.jobs];
                                if (allJobs.length >= 20) break;
                            }
                        }
                    } catch (error) {
                        console.error('Search error:', error);
                    }
                }

                const uniqueJobs = Array.from(
                    new Map(allJobs.map(job => [job.id, job])).values()
                ).slice(0, 20);

                setIsSearchingJobs(false);

                if (uniqueJobs.length > 0) {
                    const jobsDataMessage = {
                        role: 'user',
                        content: `<jobs_data>\n${JSON.stringify(uniqueJobs, null, 2)}\n</jobs_data>\n\nAnalysiere diese Jobs und präsentiere die besten Matches mit JOB_CARD Tags.`
                    };

                    await sendToAPI([...conversationHistory, jobsDataMessage]);
                } else {
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Leider habe ich keine passenden Stellen gefunden. Lass uns die Suchkriterien anpassen. Was wäre dir besonders wichtig bei deinem nächsten Job?'
                    }]);
                    setIsLoading(false);
                }
            };

            const saveJob = (job) => {
                if (!savedJobs.find(j => j.id === job.id)) {
                    setSavedJobs(prev => [...prev, job]);
                }
            };

            const handleJobAction = async (job, action) => {
                if (action === 'save') {
                    saveJob(job);
                }
                
                setJobCards(prev => prev.filter(j => j.id !== job.id));

                const feedbackMessage = {
                    role: 'user',
                    content: action === 'save' 
                        ? `Ich habe "${job.title}" bei ${job.company} gespeichert. Speichern & weiter!` 
                        : `"${job.title}" bei ${job.company} passt nicht zu mir.`
                };

                setMessages(prev => [...prev, feedbackMessage]);
                await sendToAPI([...messages, feedbackMessage]);
            };

            if (!showChat) {
                return (
                    <div style={{ backgroundColor: '#ffffff' }}>
                        {/* Header */}
                        <header style={{
                            padding: '20px 40px',
                            backgroundColor: 'white',
                            borderBottom: '1px solid #e5e7eb'
                        }}>
                            <h1 style={{
                                fontSize: '28px',
                                fontWeight: '700',
                                color: '#111827'
                            }}>TabiCoach</h1>
                        </header>

                        {/* Hero Section */}
                        <section style={{
                            padding: '80px 40px 40px',
                            textAlign: 'center',
                            backgroundColor: 'white'
                        }}>
                            <h2 style={{
                                fontSize: '56px',
                                fontWeight: '700',
                                color: '#111827',
                                marginBottom: '24px',
                                lineHeight: '1.2'
                            }}>
                                Jobs, die zu <span style={{ color: '#3b82f6' }}>dir</span> passen.
                            </h2>
                            <p style={{
                                fontSize: '20px',
                                color: '#6b7280',
                                maxWidth: '700px',
                                margin: '0 auto'
                            }}>
                                Sam versteht deine Persönlichkeit und findet Rollen, die du wirklich lieben wirst.
                            </p>
                        </section>

                        {/* Features Section */}
                        <section style={{
                            padding: '40px 40px 60px',
                            backgroundColor: '#f9fafb'
                        }}>
                            <h3 style={{
                                fontSize: '32px',
                                fontWeight: '700',
                                textAlign: 'center',
                                color: '#6b7280',
                                marginBottom: '60px'
                            }}>
                                TabiCoach ist viel mehr als eine Jobbörse
                            </h3>

                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))',
                                gap: '32px',
                                maxWidth: '1200px',
                                margin: '0 auto'
                            }}>
                                {/* Feature 1 */}
                                <div style={{
                                    backgroundColor: 'white',
                                    padding: '32px',
                                    borderRadius: '16px',
                                    textAlign: 'center',
                                    boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)'
                                }}>
                                    <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'center' }}>
                                        <BrainIcon />
                                    </div>
                                    <h4 style={{
                                        fontSize: '20px',
                                        fontWeight: '700',
                                        color: '#111827',
                                        marginBottom: '12px'
                                    }}>
                                        Sam versteht dich wirklich
                                    </h4>
                                    <p style={{
                                        fontSize: '15px',
                                        color: '#6b7280',
                                        lineHeight: '1.6'
                                    }}>
                                        Ein kurzes Gespräch – und Sam kennt deine Werte, Motivationen und Arbeitsweise. Nicht nur deinen Lebenslauf.
                                    </p>
                                </div>

                                {/* Feature 2 */}
                                <div style={{
                                    backgroundColor: 'white',
                                    padding: '32px',
                                    borderRadius: '16px',
                                    textAlign: 'center',
                                    boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)'
                                }}>
                                    <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'center' }}>
                                        <DiamondIcon />
                                    </div>
                                    <h4 style={{
                                        fontSize: '20px',
                                        fontWeight: '700',
                                        color: '#111827',
                                        marginBottom: '12px'
                                    }}>
                                        Finde auch versteckte Perlen
                                    </h4>
                                    <p style={{
                                        fontSize: '15px',
                                        color: '#6b7280',
                                        lineHeight: '1.6'
                                    }}>
                                        Sam durchsucht tausende Jobs für dich – auch die mit unerwarteten Titeln. Kein perfekter Match bleibt dir verborgen.
                                    </p>
                                </div>

                                {/* Feature 3 */}
                                <div style={{
                                    backgroundColor: 'white',
                                    padding: '32px',
                                    borderRadius: '16px',
                                    textAlign: 'center',
                                    boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)'
                                }}>
                                    <div style={{ marginBottom: '20px', display: 'flex', justifyContent: 'center' }}>
                                        <SparklesIcon />
                                    </div>
                                    <h4 style={{
                                        fontSize: '20px',
                                        fontWeight: '700',
                                        color: '#111827',
                                        marginBottom: '12px'
                                    }}>
                                        Nur relevante Jobs, kein Rauschen
                                    </h4>
                                    <p style={{
                                        fontSize: '15px',
                                        color: '#6b7280',
                                        lineHeight: '1.6'
                                    }}>
                                        Sam filtert für dich und zeigt nur Matches, die wirklich passen. Schluss mit endlosen Listen durchscrollen.
                                    </p>
                                </div>
                            </div>
                        </section>

                        {/* Chat Section */}
                        <section ref={chatSectionRef} style={{
                            backgroundColor: '#f3f4f6',
                            padding: '60px 20px 80px',
                            minHeight: '100vh'
                        }}>
                            <div style={{
                                maxWidth: '900px',
                                margin: '0 auto'
                            }}>
                                {/* Chat Container */}
                                <div style={{
                                    backgroundColor: 'white',
                                    borderRadius: '16px',
                                    boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',
                                    overflow: 'hidden'
                                }}>
                                    {/* Chat Header */}
                                    <div style={{
                                        padding: '20px 24px',
                                        backgroundColor: '#3b82f6',
                                        color: 'white',
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center'
                                    }}>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                                            <div style={{
                                                width: '44px',
                                                height: '44px',
                                                backgroundColor: 'white',
                                                borderRadius: '50%',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                fontSize: '24px'
                                            }}>
                                                🤖
                                            </div>
                                            <div>
                                                <div style={{ fontWeight: '600', fontSize: '18px' }}>Sam - Dein Karriere-Coach</div>
                                                <div style={{ fontSize: '13px', opacity: 0.9 }}>Powered by Bundesagentur für Arbeit</div>
                                            </div>
                                        </div>

                                        <button
                                            onClick={() => setShowSavedJobs(!showSavedJobs)}
                                            style={{
                                                padding: '10px 20px',
                                                backgroundColor: 'rgba(255,255,255,0.2)',
                                                color: 'white',
                                                border: '1px solid rgba(255,255,255,0.3)',
                                                borderRadius: '8px',
                                                fontSize: '14px',
                                                fontWeight: '600',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px',
                                                transition: 'background-color 0.2s'
                                            }}
                                            onMouseOver={(e) => e.target.style.backgroundColor = 'rgba(255,255,255,0.3)'}
                                            onMouseOut={(e) => e.target.style.backgroundColor = 'rgba(255,255,255,0.2)'}
                                        >
                                            <BookmarkPlusIcon />
                                            Gespeicherte Jobs ({savedJobs.length})
                                        </button>
                                    </div>

                                    {/* Messages Area */}
                                    <div style={{
                                        padding: '32px 24px',
                                        minHeight: '400px',
                                        maxHeight: '600px',
                                        overflowY: 'auto',
                                        backgroundColor: '#f9fafb'
                                    }}>
                                        {messages.map((msg, idx) => (
                                            <div
                                                key={idx}
                                                style={{
                                                    display: 'flex',
                                                    marginBottom: '24px',
                                                    justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start',
                                                    gap: '12px'
                                                }}
                                            >
                                                {msg.role === 'assistant' && (
                                                    <div style={{
                                                        width: '36px',
                                                        height: '36px',
                                                        backgroundColor: '#3b82f6',
                                                        borderRadius: '50%',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        flexShrink: 0,
                                                        fontSize: '18px'
                                                    }}>
                                                        🤖
                                                    </div>
                                                )}
                                                <div style={{
                                                    maxWidth: '75%',
                                                    padding: '16px 20px',
                                                    borderRadius: '12px',
                                                    backgroundColor: msg.role === 'user' ? '#3b82f6' : 'white',
                                                    color: msg.role === 'user' ? 'white' : '#111827',
                                                    boxShadow: msg.role === 'user' ? '0 2px 4px rgba(59, 130, 246, 0.2)' : '0 2px 4px rgba(0,0,0,0.1)',
                                                    whiteSpace: 'pre-wrap',
                                                    wordBreak: 'break-word',
                                                    fontSize: '15px',
                                                    lineHeight: '1.6'
                                                }}>
                                                    {msg.content}
                                                </div>
                                            </div>
                                        ))}

                                        {/* Loading Indicator */}
                                        {(isLoading || isSearchingJobs) && (
                                            <div style={{ display: 'flex', gap: '12px', marginBottom: '24px' }}>
                                                <div style={{
                                                    width: '36px',
                                                    height: '36px',
                                                    backgroundColor: '#3b82f6',
                                                    borderRadius: '50%',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    flexShrink: 0,
                                                    fontSize: '18px'
                                                }}>
                                                    🤖
                                                </div>
                                                <div style={{
                                                    padding: '16px 20px',
                                                    borderRadius: '12px',
                                                    backgroundColor: 'white',
                                                    boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
                                                    display: 'flex',
                                                    gap: '8px',
                                                    alignItems: 'center'
                                                }}>
                                                    <div className="bounce-dot" style={{ animationDelay: '0s' }}></div>
                                                    <div className="bounce-dot" style={{ animationDelay: '0.2s' }}></div>
                                                    <div className="bounce-dot" style={{ animationDelay: '0.4s' }}></div>
                                                    <span style={{ marginLeft: '8px', color: '#6b7280', fontSize: '14px' }}>
                                                        {isSearchingJobs ? 'Durchsuche Jobbörse...' : 'Sam tippt...'}
                                                    </span>
                                                </div>
                                            </div>
                                        )}

                                        {/* Job Cards */}
                                        {jobCards.length > 0 && (
                                            <div style={{
                                                display: 'flex',
                                                flexDirection: 'column',
                                                gap: '16px',
                                                marginTop: '16px'
                                            }}>
                                                {jobCards.map((job, idx) => (
                                                    <div
                                                        key={job.id || idx}
                                                        style={{
                                                            backgroundColor: 'white',
                                                            borderRadius: '12px',
                                                            padding: '20px',
                                                            boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
                                                            border: '2px solid #e5e7eb'
                                                        }}
                                                    >
                                                        <h3 style={{
                                                            fontSize: '18px',
                                                            fontWeight: '700',
                                                            color: '#111827',
                                                            marginBottom: '8px'
                                                        }}>
                                                            {job.title}
                                                        </h3>
                                                        <div style={{
                                                            fontSize: '14px',
                                                            color: '#6b7280',
                                                            marginBottom: '12px'
                                                        }}>
                                                            {job.company} · {job.location}
                                                        </div>
                                                        <p style={{
                                                            fontSize: '14px',
                                                            color: '#374151',
                                                            marginBottom: '16px',
                                                            lineHeight: '1.6'
                                                        }}>
                                                            {job.description}
                                                        </p>
                                                        <div style={{
                                                            display: 'flex',
                                                            gap: '12px',
                                                            flexWrap: 'wrap'
                                                        }}>
                                                            <button
                                                                onClick={() => window.open(job.url, '_blank')}
                                                                style={{
                                                                    flex: '1',
                                                                    minWidth: '120px',
                                                                    padding: '10px 16px',
                                                                    backgroundColor: '#10b981',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    fontSize: '14px',
                                                                    fontWeight: '600',
                                                                    cursor: 'pointer',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    gap: '8px'
                                                                }}
                                                            >
                                                                <CheckCircleIcon />
                                                                Bewerben
                                                            </button>
                                                            
                                                            <button
                                                                onClick={() => handleJobAction(job, 'save')}
                                                                style={{
                                                                    flex: '1',
                                                                    minWidth: '120px',
                                                                    padding: '10px 16px',
                                                                    backgroundColor: '#3b82f6',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    fontSize: '14px',
                                                                    fontWeight: '600',
                                                                    cursor: 'pointer',
                                                                    display: 'flex',
                                                                    alignItems: 'center',
                                                                    justifyContent: 'center',
                                                                    gap: '8px'
                                                                }}
                                                            >
                                                                <BookmarkPlusIcon />
                                                                Speichern & weiter
                                                            </button>

                                                            <button
                                                                onClick={() => handleJobAction(job, 'skip')}
                                                                style={{
                                                                    flex: '1',
                                                                    minWidth: '120px',
                                                                    padding: '10px 16px',
                                                                    backgroundColor: '#6b7280',
                                                                    color: 'white',
                                                                    border: 'none',
                                                                    borderRadius: '8px',
                                                                    fontSize: '14px',
                                                                    fontWeight: '600',
                                                                    cursor: 'pointer'
                                                                }}
                                                            >
                                                                Nicht interessiert
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}

                                        <div ref={messagesEndRef} />
                                    </div>

                                    {/* Input Area */}
                                    <div style={{
                                        padding: '20px 24px',
                                        backgroundColor: 'white',
                                        borderTop: '1px solid #e5e7eb'
                                    }}>
                                        <div style={{ display: 'flex', gap: '12px', alignItems: 'flex-end' }}>
                                            <input
                                                type="file"
                                                ref={fileInputRef}
                                                onChange={handleFileUpload}
                                                accept=".txt,.pdf,.doc,.docx"
                                                style={{ display: 'none' }}
                                            />
                                            
                                            <button
                                                onClick={() => fileInputRef.current?.click()}
                                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                                title="Lebenslauf hochladen"
                                                style={{
                                                    padding: '12px',
                                                    backgroundColor: '#f3f4f6',
                                                    border: '1px solid #d1d5db',
                                                    borderRadius: '8px',
                                                    cursor: (isLoading || isSearchingJobs || isUploadingCV) ? 'not-allowed' : 'pointer',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    opacity: (isLoading || isSearchingJobs || isUploadingCV) ? 0.5 : 1
                                                }}
                                            >
                                                <FileUpIcon />
                                            </button>

                                            <textarea
                                                value={input}
                                                onChange={(e) => setInput(e.target.value)}
                                                onKeyPress={(e) => {
                                                    if (e.key === 'Enter' && !e.shiftKey) {
                                                        e.preventDefault();
                                                        handleSend();
                                                    }
                                                }}
                                                placeholder="Oder schreib deine Antwort..."
                                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                                style={{
                                                    flex: 1,
                                                    padding: '12px 16px',
                                                    borderRadius: '8px',
                                                    border: '1px solid #d1d5db',
                                                    fontSize: '15px',
                                                    resize: 'none',
                                                    minHeight: '48px',
                                                    maxHeight: '120px',
                                                    fontFamily: 'inherit',
                                                    outline: 'none'
                                                }}
                                                rows={1}
                                            />

                                            <button
                                                onClick={handleSend}
                                                disabled={!input.trim() || isLoading || isSearchingJobs || isUploadingCV}
                                                style={{
                                                    padding: '12px 24px',
                                                    backgroundColor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? '#3b82f6' : '#d1d5db',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '8px',
                                                    fontSize: '15px',
                                                    fontWeight: '600',
                                                    cursor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? 'pointer' : 'not-allowed',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '8px'
                                                }}
                                            >
                                                <SendIcon />
                                                Senden
                                            </button>
                                        </div>
                                        
                                        <div style={{ marginTop: '12px', textAlign: 'center', fontSize: '12px', color: '#6b7280' }}>
                                            Powered by Claude · Jobs von Bundesagentur für Arbeit
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        {/* Saved Jobs Panel */}
                        {showSavedJobs && (
                            <div style={{
                                position: 'fixed',
                                top: '0',
                                right: '0',
                                width: '400px',
                                height: '100vh',
                                backgroundColor: 'white',
                                boxShadow: '-4px 0 8px rgba(0,0,0,0.1)',
                                zIndex: 1000,
                                display: 'flex',
                                flexDirection: 'column'
                            }}>
                                <div style={{
                                    padding: '20px',
                                    borderBottom: '1px solid #e5e7eb',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <h3 style={{ fontSize: '20px', fontWeight: '700' }}>
                                        Gespeicherte Jobs
                                    </h3>
                                    <button
                                        onClick={() => setShowSavedJobs(false)}
                                        style={{
                                            padding: '8px',
                                            backgroundColor: 'transparent',
                                            border: 'none',
                                            cursor: 'pointer',
                                            fontSize: '24px',
                                            color: '#6b7280'
                                        }}
                                    >
                                        ×
                                    </button>
                                </div>
                                
                                <div style={{
                                    flex: 1,
                                    overflowY: 'auto',
                                    padding: '20px'
                                }}>
                                    {savedJobs.length === 0 ? (
                                        <p style={{ color: '#6b7280', textAlign: 'center' }}>
                                            Noch keine Jobs gespeichert
                                        </p>
                                    ) : (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                            {savedJobs.map((job) => (
                                                <div
                                                    key={job.id}
                                                    style={{
                                                        padding: '16px',
                                                        backgroundColor: '#f9fafb',
                                                        borderRadius: '8px',
                                                        border: '1px solid #e5e7eb'
                                                    }}
                                                >
                                                    <h4 style={{
                                                        fontSize: '16px',
                                                        fontWeight: '600',
                                                        marginBottom: '4px',
                                                        color: '#111827'
                                                    }}>
                                                        {job.title}
                                                    </h4>
                                                    <p style={{
                                                        fontSize: '14px',
                                                        color: '#6b7280',
                                                        marginBottom: '12px'
                                                    }}>
                                                        {job.company} · {job.location}
                                                    </p>
                                                    <div style={{
                                                        display: 'flex',
                                                        gap: '8px'
                                                    }}>
                                                        <button
                                                            onClick={() => window.open(job.url, '_blank')}
                                                            style={{
                                                                flex: '1',
                                                                padding: '8px 12px',
                                                                backgroundColor: '#10b981',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '6px',
                                                                fontSize: '13px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '6px'
                                                            }}
                                                        >
                                                            <CheckCircleIcon />
                                                            Bewerben
                                                        </button>
                                                        
                                                        <button
                                                            onClick={() => {
                                                                setSavedJobs(prev => prev.filter(j => j.id !== job.id));
                                                            }}
                                                            style={{
                                                                padding: '8px 12px',
                                                                backgroundColor: '#ef4444',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '6px',
                                                                fontSize: '13px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '6px'
                                                            }}
                                                        >
                                                            <Trash2Icon />
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return null;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<SamCareerCoach />);
    </script>
</body>
</html>
