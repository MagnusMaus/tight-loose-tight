<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sam - Karriere-Coach</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        #root {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const { createRoot } = ReactDOM;

        // Lucide icons
        const SendIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg>
        );

        const FileUpIcon = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="12" y1="18" x2="12" y2="12"></line>
                <line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
        );

        const CheckCircleIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const BookmarkPlusIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                <line x1="12" y1="7" x2="12" y2="13"></line>
                <line x1="9" y1="10" x2="15" y2="10"></line>
            </svg>
        );

        const Trash2Icon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const SearchIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const UploadIcon = () => (
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const SamCareerCoach = () => {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [jobCards, setJobCards] = useState([]);
            const [savedJobs, setSavedJobs] = useState([]);
            const [showSavedJobs, setShowSavedJobs] = useState(false);
            const [isSearchingJobs, setIsSearchingJobs] = useState(false);
            const [isUploadingCV, setIsUploadingCV] = useState(false);
            const [shownJobUrls, setShownJobUrls] = useState(new Set()); // âœ¨ FIX 1: Trackt bereits gezeigte Jobs
            const messagesEndRef = useRef(null);
            const fileInputRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages, jobCards]);

            useEffect(() => {
                const greeting = getGreeting();
                setMessages([{
                    role: 'assistant',
                    content: greeting
                }]);
            }, []);

            const getGreeting = () => {
                const hour = new Date().getHours();
                let timeOfDay;
                if (hour < 12) timeOfDay = 'Morgen';
                else if (hour < 18) timeOfDay = 'Mittag';
                else timeOfDay = 'Abend';

                return `Guten ${timeOfDay}, schÃ¶n, dass du da bist. Mein Name ist Sam. Ich bin hier, um dich dabei zu unterstÃ¼tzen, deinen nÃ¤chsten Karriereschritt zu finden.

Damit dieser Schritt genau zu dir passt, stelle ich dir gleich ein paar Fragen. Je offener und prÃ¤ziser du sie beantwortest, desto besser wird das Ergebnis. Keine Sorge! Deine Daten sind bei mir sicher. Sie sind von niemandem sonst einsehbar.

In welcher beruflichen Situation befindest du dich gerade?`;
            };

            const getSystemPrompt = () => {
                return `Du bist Sam, ein fortschrittlicher KI-Karriere-Coach und Recruiting-Experte.

WICHTIG: Du hast Zugriff auf die Arbeitsagentur JobbÃ¶rse - die GRÃ–ÃŸTE deutsche Stellendatenbank mit INTELLIGENTER GESTAFFELTER SUCHE!

JOB-SUCHE BEST PRACTICES:
- Verwende SPEZIFISCHE Suchbegriffe basierend auf dem Profil: "Operations Director", "Head of Marketing", etc.
- Location: IMMER eine konkrete deutsche Stadt angeben ("Berlin", "MÃ¼nchen", "Hamburg", "Hannover")
- NIEMALS location leer lassen - die API verlangt konkrete StÃ¤dte!
- Das System erweitert automatisch: spezifisch â†’ breit, lokal â†’ deutschlandweit

PROAKTIVES VERHALTEN:
- Starte mit psychografisch prÃ¤zisen Queries - das System macht sie automatisch breiter wenn nÃ¶tig
- Sage dem Nutzer NICHT, dass du suchst oder was du suchst
- Das System probiert automatisch Query-Varianten und verschiedene Locations
- Der Nutzer sieht nur erfolgreiche Ergebnisse

CV-UPLOAD: Zeige NIEMALS rohe CV-Daten, nur persÃ¶nliche Antworten.

====================================
KRITISCHE REGEL: TRIGGER_SEARCH vs JOB_CARD
====================================

Es gibt NUR ZWEI Situationen wo du diese Tags verwendest:

1ï¸âƒ£ TRIGGER_SEARCH - VERWENDE NUR WENN:
   âœ… Du bereit bist eine NEUE Job-Suche zu starten
   âœ… User sagt "Speichern & weiter" oder "Zeige mir weitere Stellen"
   âœ… User lehnt einen Job ab
   âœ… Du NOCH KEINE Jobs zur Analyse bekommen hast

   âŒ NIEMALS verwenden wenn du bereits Jobs zur Analyse bekommen hast!

2ï¸âƒ£ JOB_CARD - VERWENDE NUR WENN:
   âœ… Du hast gerade Jobs ZUR ANALYSE bekommen (System sendet dir 5 Jobs)
   âœ… Du sollst den BESTEN Job empfehlen
   âœ… Du siehst einen Job-Titel, Firma, Beschreibung in der Nachricht
   
   âŒ NIEMALS zusammen mit TRIGGER_SEARCH verwenden!

====================================

WENN DU JOBS ZUR ANALYSE BEKOMMST:
- Das System sendet dir 5 Jobs mit: Titel, Firma, Ort, Beschreibung
- Du MUSST dann SOFORT eine JOB_CARD erstellen
- Bewerte ALLE 5 Jobs intern (50% psychografisch!)
- WÃ¤hle den BESTEN aus
- Erstelle NUR eine JOB_CARD - KEINEN TRIGGER_SEARCH!

Format:

[Deine persÃ¶nliche Analyse warum dieser Job passt]

[JOB_CARD:{
  "title": "Job Titel",
  "company": "Firma", 
  "location": "Ort",
  "salary": "Gehalt",
  "description": "2-3 SÃ¤tze",
  "fitScore": 85,
  "pros": ["Passt weil..."],
  "cons": ["Beachte..."],
  "applyUrl": "https://..."
}]

WENN USER "SPEICHERN & WEITER" SAGT:
- User will mehr Optionen sehen
- Erstelle NEUEN TRIGGER_SEARCH (KEINE JOB_CARD!)
- Query kann Ã¤hnlich sein oder leicht variieren

Format:

Super! Ich schaue nach weiteren Positionen. ðŸ”

[TRIGGER_SEARCH:{
  "query": "...",
  "location": "..."
}]

====================================

GESPRÃ„CHSFÃœHRUNG:
- Stelle NUR EINE Frage pro Nachricht
- Nutze Emojis angemessen
- Frage gezielt nach fÃ¼r vollstÃ¤ndiges Profil

PROFILERSTELLUNG (50% des Fit-Scores!):
1. Werte & Motivatoren
2. Arbeitspsychologie  
3. Umfeld-PrÃ¤ferenzen

DREI HAUPTFRAGEN:
1. Berufliche Situation?
2. Berufliche Entwicklung (3-5 Jahre)?
3. FÃ¤higkeiten & Erfahrungen? (CV-Upload mÃ¶glich)

JOBEMPFEHLUNGEN:
- IMMER nur EINEN Job pro Nachricht
- ErklÃ¤re psychografischen Fit ausfÃ¼hrlich
- Warte auf Feedback
- Du hÃ¶rst NUR auf wenn User EXPLIZIT stoppt`;
            };

            const parseJobCard = (text) => {
                console.log('ðŸ” parseJobCard() called');
                console.log('   Input length:', text.length, 'chars');
                
                const jobMatch = text.match(/\[JOB_CARD:\s*(\{[\s\S]*?\})\s*\]/);
                
                if (!jobMatch) {
                    console.log('   âŒ No [JOB_CARD:{...}] pattern found in text');
                    console.log('   First 200 chars:', text.substring(0, 200));
                    return null;
                }
                
                console.log('   âœ… [JOB_CARD:{...}] pattern found!');
                console.log('   Raw JSON:', jobMatch[1].substring(0, 100) + '...');

                try {
                    const jsonString = jobMatch[1].trim();
                    const jobData = JSON.parse(jsonString);
                    console.log('   âœ… JSON parsed successfully!');
                    console.log('   Job title:', jobData.title);
                    console.log('   Company:', jobData.company);
                    console.log('   Fit score:', jobData.fitScore);
                    
                    const cleanText = text.replace(/\[JOB_CARD:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                    console.log('   Clean text length:', cleanText.length, 'chars');
                    
                    return { jobData, cleanText };
                } catch (e) {
                    console.error('   âŒ Error parsing job card JSON:', e);
                    console.error('   Raw JSON string:', jobMatch[1]);
                    return null;
                }
            };

            // ZENTRALE FUNKTION: Verarbeitet Sam's Response (mit oder ohne TRIGGER_SEARCH)
            const processSamResponse = async (assistantMessage, updatedMessages) => {
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ðŸ“¥ DEBUG: processSamResponse called');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ðŸ“ FULL SAM RESPONSE:');
                console.log(assistantMessage);
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                
                // SCHRITT 1: Check fÃ¼r TRIGGER_SEARCH (PrioritÃ¤t!)
                const searchTrigger = assistantMessage.match(/\[TRIGGER_SEARCH:\s*(\{[\s\S]*?\})\s*\]/);
                
                console.log('ðŸ” DEBUG: Checking for TRIGGER_SEARCH...');
                console.log('   Found:', searchTrigger ? 'YES âœ…' : 'NO âŒ');
                
                if (searchTrigger) {
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ” DEBUG: TRIGGER_SEARCH detected!');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ“‹ Raw JSON string:', searchTrigger[1]);
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    try {
                        const searchParams = JSON.parse(searchTrigger[1]);
                        console.log('âœ… Parsed successfully:', searchParams);
                        
                        // Entferne TRIGGER_SEARCH aus Text
                        const cleanMessage = assistantMessage.replace(/\[TRIGGER_SEARCH:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                        
                        console.log('ðŸ“ Text BEFORE TRIGGER_SEARCH:');
                        console.log(cleanMessage || '(empty)');
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        
                        // Zeige Sam's Nachricht (ohne TRIGGER_SEARCH)
                        if (cleanMessage) {
                            console.log('ðŸ’¬ Adding clean message to chat');
                            setMessages(prev => [...prev, { role: 'assistant', content: cleanMessage }]);
                        }
                        
                        setIsLoading(false);
                        
                        console.log('ðŸš€ Starting job search with query:', searchParams.query, 'location:', searchParams.location);
                        
                        // Starte Job-Suche
                        await searchJobs(searchParams.query, searchParams.location, updatedMessages, 0, new Set());
                        return true; // Verarbeitet!
                        
                    } catch (e) {
                        console.error('âŒ Error parsing TRIGGER_SEARCH JSON:', e);
                        console.error('Raw JSON:', searchTrigger[1]);
                        
                        // WICHTIG: Auch bei Parse-Error den TRIGGER_SEARCH entfernen und cleaned message anzeigen!
                        const cleanMessage = assistantMessage.replace(/\[TRIGGER_SEARCH:\s*\{[\s\S]*?\}\s*\]/g, '').trim();
                        if (cleanMessage) {
                            setMessages(prev => [...prev, { role: 'assistant', content: cleanMessage }]);
                        }
                        
                        // Zeige Fehlermeldung
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: 'Entschuldige, da gab es ein technisches Problem. Lass uns manuell weitersuchen - welche Art von Position interessiert dich am meisten? ðŸ¤”'
                        }]);
                        
                        setIsLoading(false);
                        return true; // Verhindere dass der rohe TRIGGER_SEARCH angezeigt wird!
                    }
                }
                
                // SCHRITT 2: Check fÃ¼r JOB_CARD
                console.log('ðŸ” DEBUG: Checking for JOB_CARD...');
                const parsed = parseJobCard(assistantMessage);
                console.log('   Found:', parsed ? 'YES âœ…' : 'NO âŒ');
                
                if (parsed) {
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ“‹ DEBUG: JOB_CARD detected and parsed!');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ’¼ Job:', parsed.jobData.title);
                    console.log('ðŸ¢ Company:', parsed.jobData.company);
                    console.log('ðŸ“ Location:', parsed.jobData.location);
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    setJobCards(prev => [...prev, { ...parsed.jobData, id: Date.now() }]);
                    if (parsed.cleanText) {
                        console.log('ðŸ’¬ Adding clean text before card:', parsed.cleanText.substring(0, 100) + '...');
                        setMessages(prev => [...prev, { role: 'assistant', content: parsed.cleanText }]);
                    }
                    return true;
                }
                
                // SCHRITT 3: Normaler Text
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ðŸ’¬ DEBUG: Normal message (no TRIGGER_SEARCH or JOB_CARD)');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ðŸ“ Message content:', assistantMessage.substring(0, 200) + '...');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                
                setMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
                return true;
            };

            // ========================================
            // NEUE INTELLIGENTE GESTAFFELTE JOB-SUCHE
            // ========================================
            
            // Generiert Query-Varianten: spezifisch â†’ breit
            const generateQueryVariants = (query) => {
                const variants = [query];
                const words = query.split(' ').filter(w => w.length > 2);
                
                // Extrahiere Kernbegriffe und erstelle breitere Varianten
                if (words.length >= 3) {
                    // Z.B. "Operations Director Manager" â†’ "Operations Director" â†’ "Operations Manager" â†’ "Director" â†’ "Manager"
                    variants.push(words.slice(0, 2).join(' '));
                    variants.push(words[0] + ' ' + words[words.length - 1]);
                    variants.push(words[0]);
                    variants.push(words[words.length - 1]);
                } else if (words.length === 2) {
                    // Z.B. "Operations Director" â†’ "Operations Manager" â†’ "Operations" â†’ "Director"
                    variants.push(words[0] + ' Manager');
                    variants.push(words[0]);
                    variants.push(words[1]);
                } else if (words.length === 1) {
                    // Single word - add "Manager" variant
                    variants.push(words[0] + ' Manager');
                }
                
                // Remove duplicates und behalte Reihenfolge
                const unique = [...new Set(variants)];
                console.log('ðŸ“Š Query variants:', unique);
                return unique;
            };
            
            // Generiert Location-Tiers: lokal â†’ regional â†’ Ã¼berregional
            const generateLocationTiers = (userRegion = 'Hannover') => {
                const tiers = [
                    // Runde 1: Nutzer-Region lokal
                    { location: userRegion, radius: 50, label: 'Lokal' },
                    { location: userRegion, radius: 100, label: 'Regional' },
                    
                    // Runde 2: GroÃŸe StÃ¤dte fÃ¼r deutschlandweite Abdeckung
                    { location: 'Berlin', radius: 100, label: 'Berlin Region' },
                    { location: 'MÃ¼nchen', radius: 100, label: 'MÃ¼nchen Region' },
                    { location: 'Hamburg', radius: 100, label: 'Hamburg Region' },
                    
                    // Runde 3: Erweiterte Suche
                    { location: 'Frankfurt', radius: 150, label: 'Frankfurt erweitert' },
                    { location: 'KÃ¶ln', radius: 150, label: 'KÃ¶ln erweitert' },
                    
                    // Runde 4: Garantierter Fallback
                    { location: 'Berlin', radius: 200, label: 'Berlin deutschlandweit' }
                ];
                
                console.log('ðŸ“ Location tiers:', tiers);
                return tiers;
            };
            
            // Einzelner API-Call zur Arbeitsagentur
            const searchJobsAPI = async (query, location, radius) => {
                const response = await fetch('/.netlify/functions/search-jobs-arbeitsagentur', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: query,
                        location: location,
                        radius: radius,
                        size: 25
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                return await response.json();
            };
            
            // Hauptfunktion: Intelligente gestaffelte Suche
            const searchJobs = async (query, location, currentMessages, retryCount = 0, triedSet = new Set()) => {
                console.log('ðŸŽ¯ Starting intelligent tiered search for:', query);
                
                setIsSearchingJobs(true);
                
                try {
                    // Generiere Query-Varianten und Location-Tiers
                    const queryVariants = generateQueryVariants(query);
                    const userRegion = location || 'Hannover'; // Default zu Hannover wenn keine Location
                    const locationTiers = generateLocationTiers(userRegion);
                    
                    let attemptNumber = 0;
                    let foundJobs = null;
                    
                    // Durchlaufe alle Kombinationen: Query-Varianten Ã— Location-Tiers
                    for (const queryVariant of queryVariants) {
                        if (foundJobs) break; // Stop wenn Jobs gefunden
                        
                        for (const locationTier of locationTiers) {
                            attemptNumber++;
                            
                            console.log(`ðŸ” Attempt ${attemptNumber}: "${queryVariant}" in ${locationTier.location} (${locationTier.radius}km) [${locationTier.label}]`);
                            
                            try {
                                const data = await searchJobsAPI(queryVariant, locationTier.location, locationTier.radius);
                                
                                console.log(`ðŸ“Š Result: ${data.total || 0} jobs found`);
                                
                                if (data.jobs && data.jobs.length > 0) {
                                    // âœ¨ FIX 1: Filtere bereits gezeigte Jobs SOFORT
                                    console.log(`   ðŸ“‹ Total jobs from API: ${data.jobs.length}`);
                                    console.log(`   ðŸ” Already shown jobs: ${shownJobUrls.size}`);
                                    
                                    const newJobs = data.jobs.filter(job => {
                                        const jobKey = job.url || `${job.title}_${job.company}`;
                                        const isNew = !shownJobUrls.has(jobKey);
                                        if (!isNew) {
                                            console.log(`   â­ï¸  Skipping already shown: "${job.title}" at ${job.company}`);
                                        }
                                        return isNew;
                                    });
                                    
                                    console.log(`   âœ¨ New jobs after filtering: ${newJobs.length}`);
                                    
                                    // Nur wenn NEUE Jobs nach Filterung -> als Erfolg werten
                                    if (newJobs.length > 0) {
                                        console.log(`ðŸŽ‰ SUCCESS! Found ${newJobs.length} NEW jobs!`);
                                        foundJobs = {
                                            jobs: newJobs,
                                            query: queryVariant,
                                            location: locationTier.location
                                        };
                                        break; // Erfolg - stop die innere Schleife
                                    } else {
                                        console.log('âš ï¸  All jobs were already shown - continuing search...');
                                        // Kein break - weitermachen mit nÃ¤chster Kombination
                                    }
                                } else {
                                    console.log('ðŸ“­ No jobs, trying next combination...');
                                }
                                
                            } catch (error) {
                                console.error(`âŒ Error in attempt ${attemptNumber}:`, error);
                                // Continue mit nÃ¤chster Kombination
                            }
                        }
                    }
                    
                    // Check ob Jobs gefunden wurden
                    if (!foundJobs) {
                        console.error('âŒ All combinations exhausted - no jobs found');
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: `Ich habe sehr grÃ¼ndlich gesucht, aber leider keine passenden Stellen gefunden. Lass uns gemeinsam Ã¼berlegen: KÃ¶nnten wir das Suchprofil etwas anpassen? Vielleicht verwandte Rollen oder andere Branchen einbeziehen? ðŸ¤”`
                        }]);
                        setIsSearchingJobs(false);
                        return null;
                    }
                    
                    // Jobs gefunden! Sende an Sam zur Bewertung
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ“¤ DEBUG: Sending jobs to Sam for ANALYSIS');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log(`   Jobs found: ${foundJobs.jobs.length}`);
                    console.log(`   Query: "${foundJobs.query}"`);
                    console.log(`   Location: "${foundJobs.location}"`);
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    const jobsContext = `[SYSTEM: JOB-ANALYSE-MODUS]

Hier sind ${foundJobs.jobs.length} Jobs von der Bundesagentur fÃ¼r "${foundJobs.query}" in "${foundJobs.location}":

${foundJobs.jobs.slice(0, 5).map((job, i) => `
Job ${i + 1}:
- Titel: ${job.title}
- Firma: ${job.company}
- Ort: ${job.location}
- Beschreibung: ${job.description}
- Link: ${job.url}
`).join('\n')}

DEINE AUFGABE:
1. Bewerte ALLE 5 Jobs intern (50% psychografisch, 30% Skills, 20% Umfeld)
2. WÃ¤hle den BESTEN Job basierend auf dem PersÃ¶nlichkeitsprofil
3. Erstelle EINE JOB_CARD fÃ¼r diesen Job

WICHTIG: 
âœ… Erstelle NUR eine JOB_CARD
âŒ KEINEN TRIGGER_SEARCH verwenden!
âŒ Dieser Prompt bedeutet NICHT "suche weitere Jobs"
âŒ Du musst NUR den besten der 5 gegebenen Jobs empfehlen

Format:
[Deine persÃ¶nliche Analyse des Jobs - 2-3 SÃ¤tze]

[JOB_CARD:{...}]

BegrÃ¼nde ausfÃ¼hrlich warum dieser Job zum PersÃ¶nlichkeitsprofil passt.`;

                    const updatedMessages = [...currentMessages, {
                        role: 'user',
                        content: jobsContext
                    }];

                    console.log('ðŸŒ Calling Sam API for job analysis...');
                    const samResponse = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });
                    console.log('âœ… API Response received! Status:', samResponse.status);

                    if (!samResponse.ok) {
                        console.error('âŒ API Response NOT OK:', samResponse.status, samResponse.statusText);
                        throw new Error(`API returned ${samResponse.status}`);
                    }

                    const samData = await samResponse.json();
                    console.log('ðŸ“¦ Response JSON parsed successfully');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ¤– SAM\'S ANALYSIS RESPONSE:');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    const assistantMessage = samData.content[0].text;
                    console.log(assistantMessage);
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ“ Response length:', assistantMessage.length, 'characters');
                    console.log('ðŸ” Checking if response contains JOB_CARD...');

                    const parsed = parseJobCard(assistantMessage);
                    console.log('ðŸŽ¯ parseJobCard result:', parsed ? 'FOUND JOB_CARD âœ…' : 'NO JOB_CARD âŒ');
                    
                    if (parsed) {
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        console.log('âœ¨ Creating JOB_CARD!');
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        console.log('ðŸ“‹ Job Data:', JSON.stringify(parsed.jobData, null, 2));
                        console.log('ðŸ’¬ Clean Text:', parsed.cleanText ? parsed.cleanText.substring(0, 100) + '...' : '(none)');
                        
                        const newCard = { ...parsed.jobData, id: Date.now() };
                        console.log('ðŸ†” Card ID:', newCard.id);
                        console.log('ðŸ¢ Job Title:', newCard.title);
                        console.log('ðŸ”— Job URL:', newCard.applyUrl || newCard.url || '(no URL)');
                        
                        setJobCards(prev => {
                            console.log('ðŸ“Š Current jobCards count:', prev.length);
                            console.log('âž• Adding new card, new count will be:', prev.length + 1);
                            return [...prev, newCard];
                        });
                        
                        // âœ¨ FIX 1: Tracke diese Job-URL als "gezeigt"
                        const jobKey = parsed.jobData.applyUrl || parsed.jobData.url || `${parsed.jobData.title}_${parsed.jobData.company}`;
                        setShownJobUrls(prev => new Set([...prev, jobKey]));
                        console.log(`âœ… Added to shown jobs: "${parsed.jobData.title}" (Total shown: ${shownJobUrls.size + 1})`);
                        
                        if (parsed.cleanText) {
                            console.log('ðŸ’¬ Adding Sam\'s analysis message to chat');
                            setMessages(prev => [...prev, { role: 'assistant', content: parsed.cleanText }]);
                        }
                        console.log('âœ… JOB_CARD successfully added to UI!');
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    } else {
                        // âœ¨ FIX 2: Check ob Sam einen TRIGGER_SEARCH zurÃ¼ckgegeben hat!
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        console.log('âš ï¸  NO JOB_CARD FOUND in response!');
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                        
                        // Check ob Response einen TRIGGER_SEARCH enthÃ¤lt
                        if (assistantMessage.includes('[TRIGGER_SEARCH:')) {
                            console.log('ðŸ” Response contains TRIGGER_SEARCH - Sam wants to search differently!');
                            console.log('ðŸ“ Processing TRIGGER_SEARCH via processSamResponse...');
                            
                            // WICHTIG: Nutze processSamResponse um TRIGGER_SEARCH richtig zu verarbeiten!
                            const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                            await processSamResponse(assistantMessage, messagesWithResponse);
                            console.log('âœ… TRIGGER_SEARCH processed successfully!');
                        } else {
                            console.log('ðŸ“ Adding Sam\'s message as normal text (no card, no TRIGGER_SEARCH)');
                            console.log('Message preview:', assistantMessage.substring(0, 200) + '...');
                            setMessages(prev => [...prev, { role: 'assistant', content: assistantMessage }]);
                            console.log('âš ï¸  This is unexpected - Sam should have created a JOB_CARD!');
                        }
                        console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    }
                    
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ searchJobs() completed successfully!');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    setIsSearchingJobs(false);
                    return foundJobs.jobs;

                } catch (error) {
                    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.error('âŒ CRITICAL ERROR in searchJobs!');
                    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.error('Error type:', error.name);
                    console.error('Error message:', error.message);
                    console.error('Error stack:', error.stack);
                    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Technisches Problem bei der Suche. Lass uns es nochmal versuchen! ðŸ”§'
                    }]);
                    setIsSearchingJobs(false);
                    return null;
                }
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files?.[0];
                if (!file) return;

                setIsUploadingCV(true);
                console.log('ðŸ“„ CV upload started');
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const base64Data = e.target.result.split(',')[1];
                        
                        const response = await fetch('/.netlify/functions/parse-cv', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                fileData: base64Data,
                                fileName: file.name,
                                fileType: file.type
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error('Upload fehlgeschlagen');
                        }
                        
                        const data = await response.json();
                        const fileMessage = `[SYSTEM: Der Nutzer hat seinen Lebenslauf hochgeladen. Analysiere und antworte persÃ¶nlich. Zeige NICHT die rohen Daten.]\n\n${data.text}`;
                        
                        const updatedMessages = [...messages, { role: 'user', content: fileMessage }];
                        setIsUploadingCV(false);
                        setIsLoading(true);

                        const samResponse = await fetch('/.netlify/functions/chat', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                messages: updatedMessages,
                                system: getSystemPrompt()
                            })
                        });

                        const samData = await samResponse.json();
                        const assistantMessage = samData.content[0].text;

                        // WICHTIG: Nutze zentrale Verarbeitungsfunktion!
                        // updatedMessages muss die Assistant-Message enthalten fÃ¼r searchJobs!
                        const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                        await processSamResponse(assistantMessage, messagesWithResponse);
                        setIsLoading(false);
                        
                    } catch (error) {
                        console.error('âŒ CV upload error:', error);
                        setMessages([...messages, {
                            role: 'assistant',
                            content: 'Fehler beim Verarbeiten. Bitte nochmal versuchen. ðŸ”§'
                        }]);
                        setIsUploadingCV(false);
                        setIsLoading(false);
                    }
                };
                reader.readAsDataURL(file);
            };

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;

                const userMessage = { role: 'user', content: input };
                const updatedMessages = [...messages, userMessage];
                setMessages(updatedMessages);
                setInput('');
                setIsLoading(true);

                try {
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;

                    // Nutze zentrale Verarbeitungsfunktion!
                    // updatedMessages muss die Assistant-Message enthalten fÃ¼r searchJobs!
                    const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                    await processSamResponse(assistantMessage, messagesWithResponse);

                } catch (error) {
                    console.error('âŒ Error:', error);
                    setMessages([...updatedMessages, { 
                        role: 'assistant', 
                        content: 'Technischer Fehler. Bitte nochmal versuchen.' 
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleJobAction = async (jobId, action) => {
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('ðŸŽ¬ DEBUG: handleJobAction called');
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                console.log('   Action:', action);
                console.log('   Job ID:', jobId);
                console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                
                const job = jobCards.find(j => j.id === jobId);
                if (!job) return;

                let userResponse = '';
                if (action === 'apply') {
                    userResponse = `Ich mÃ¶chte mich fÃ¼r "${job.title}" bewerben.`;
                    if (job.applyUrl) window.open(job.applyUrl, '_blank');
                } else if (action === 'save') {
                    console.log('ðŸ’¾ DEBUG: User clicked SAVE button - expecting TRIGGER_SEARCH in response!');
                    setSavedJobs(prev => {
                        if (prev.find(j => j.id === jobId)) return prev;
                        return [...prev, job];
                    });
                    userResponse = `"${job.title}" gespeichert. Zeige mir weitere Stellen.`;
                } else if (action === 'reject') {
                    userResponse = `"${job.title}" passt nicht.`;
                }

                console.log('ðŸ“¤ DEBUG: Sending to Sam:', userResponse);
                
                setJobCards(prev => prev.filter(j => j.id !== jobId));

                const userMessage = { role: 'user', content: userResponse };
                const updatedMessages = [...messages, userMessage];
                // Zeige user message sofort
                setMessages(updatedMessages);
                setIsLoading(true);

                try {
                    const response = await fetch('/.netlify/functions/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            messages: updatedMessages,
                            system: getSystemPrompt()
                        })
                    });

                    const data = await response.json();
                    const assistantMessage = data.content[0].text;
                    
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    console.log('ðŸ“¨ DEBUG: Sam response after handleJobAction:');
                    console.log('   Context: After user clicked "' + action + '"');
                    console.log('   Expected: TRIGGER_SEARCH (if save/reject) or normal text (if apply)');
                    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
                    
                    // Nutze zentrale Verarbeitungsfunktion!
                    // WICHTIG: processSamResponse fÃ¼gt die assistant message hinzu - wir tun das NICHT hier!
                    const messagesWithResponse = [...updatedMessages, { role: 'assistant', content: assistantMessage }];
                    await processSamResponse(assistantMessage, messagesWithResponse);

                } catch (error) {
                    console.error('âŒ Error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Fehler. Lass uns weitermachen! ðŸ”§'
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            return (
                <div style={{
                    maxWidth: '900px',
                    margin: '0 auto',
                    height: '100vh',
                    display: 'flex',
                    flexDirection: 'column',
                    backgroundColor: '#f8f9fa'
                }}>
                    <div style={{
                        backgroundColor: '#2563eb',
                        color: 'white',
                        padding: '20px',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <div style={{ textAlign: 'left' }}>
                            <h1 style={{ margin: 0, fontSize: '24px', fontWeight: '600' }}>
                                ðŸ’¼ Sam - Dein Karriere-Coach
                            </h1>
                            <p style={{ margin: '5px 0 0 0', fontSize: '14px', opacity: 0.9 }}>
                                Powered by Bundesagentur fÃ¼r Arbeit
                            </p>
                        </div>
                        
                        {savedJobs.length > 0 && (
                            <button
                                onClick={() => setShowSavedJobs(true)}
                                style={{
                                    backgroundColor: 'rgba(255,255,255,0.2)',
                                    border: '2px solid white',
                                    color: 'white',
                                    padding: '10px 20px',
                                    borderRadius: '8px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                ðŸ“‹ Gespeicherte Jobs ({savedJobs.length})
                            </button>
                        )}
                    </div>

                    <div style={{
                        flex: 1,
                        overflowY: 'auto',
                        padding: '20px',
                        display: 'flex',
                        flexDirection: 'column',
                        gap: '16px'
                    }}>
                        {messages.map((message, index) => (
                            <div
                                key={index}
                                style={{
                                    display: 'flex',
                                    justifyContent: message.role === 'user' ? 'flex-end' : 'flex-start'
                                }}
                            >
                                <div style={{
                                    maxWidth: '70%',
                                    padding: '12px 16px',
                                    borderRadius: '12px',
                                    backgroundColor: message.role === 'user' ? '#2563eb' : 'white',
                                    color: message.role === 'user' ? 'white' : '#1f2937',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    whiteSpace: 'pre-wrap',
                                    lineHeight: '1.5'
                                }}>
                                    {message.content}
                                </div>
                            </div>
                        ))}

                        {jobCards.map((job) => (
                            <div key={job.id} style={{
                                backgroundColor: 'white',
                                borderRadius: '16px',
                                padding: '24px',
                                boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                                border: '2px solid #e5e7eb',
                                maxWidth: '85%',
                                margin: '0 auto',
                                width: '100%'
                            }}>
                                <div style={{
                                    display: 'inline-block',
                                    backgroundColor: job.fitScore >= 80 ? '#10b981' : job.fitScore >= 60 ? '#f59e0b' : '#ef4444',
                                    color: 'white',
                                    padding: '4px 12px',
                                    borderRadius: '20px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    marginBottom: '12px'
                                }}>
                                    {job.fitScore}% Match
                                </div>

                                <h3 style={{ margin: '0 0 8px 0', fontSize: '20px', fontWeight: '600', color: '#1f2937' }}>
                                    {job.title}
                                </h3>

                                <div style={{ display: 'flex', gap: '16px', fontSize: '14px', color: '#6b7280', marginBottom: '16px', flexWrap: 'wrap' }}>
                                    <span>ðŸ¢ {job.company}</span>
                                    <span>ðŸ“ {job.location}</span>
                                    {job.salary && <span>ðŸ’° {job.salary}</span>}
                                </div>

                                <p style={{ fontSize: '15px', lineHeight: '1.6', color: '#374151', marginBottom: '16px' }}>
                                    {job.description}
                                </p>

                                {job.pros && job.pros.length > 0 && (
                                    <div style={{ marginBottom: '12px' }}>
                                        <div style={{ fontSize: '14px', fontWeight: '600', color: '#10b981', marginBottom: '6px' }}>
                                            âœ… Was passt:
                                        </div>
                                        <ul style={{ margin: 0, paddingLeft: '20px', fontSize: '14px', color: '#374151' }}>
                                            {job.pros.map((pro, i) => (
                                                <li key={i} style={{ marginBottom: '4px' }}>{pro}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                {job.cons && job.cons.length > 0 && (
                                    <div style={{ marginBottom: '20px' }}>
                                        <div style={{ fontSize: '14px', fontWeight: '600', color: '#f59e0b', marginBottom: '6px' }}>
                                            âš ï¸ Beachte:
                                        </div>
                                        <ul style={{ margin: 0, paddingLeft: '20px', fontSize: '14px', color: '#374151' }}>
                                            {job.cons.map((con, i) => (
                                                <li key={i} style={{ marginBottom: '4px' }}>{con}</li>
                                            ))}
                                        </ul>
                                    </div>
                                )}

                                <div style={{ display: 'flex', gap: '12px', marginTop: '20px', flexWrap: 'wrap' }}>
                                    <button
                                        onClick={() => handleJobAction(job.id, 'apply')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#2563eb',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <CheckCircleIcon />
                                        Bewerben
                                    </button>
                                    
                                    <button
                                        onClick={() => handleJobAction(job.id, 'save')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#10b981',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <BookmarkPlusIcon />
                                        Speichern & weiter
                                    </button>
                                    
                                    <button
                                        onClick={() => handleJobAction(job.id, 'reject')}
                                        style={{
                                            flex: '1',
                                            minWidth: '140px',
                                            padding: '12px 20px',
                                            backgroundColor: '#ef4444',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '8px',
                                            fontSize: '15px',
                                            fontWeight: '600',
                                            cursor: 'pointer',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '8px'
                                        }}
                                    >
                                        <Trash2Icon />
                                        Verwerfen
                                    </button>
                                </div>
                            </div>
                        ))}

                        {(isLoading || isSearchingJobs || isUploadingCV) && (
                            <div style={{ display: 'flex', justifyContent: 'flex-start' }}>
                                <div style={{
                                    padding: '12px 16px',
                                    borderRadius: '12px',
                                    backgroundColor: 'white',
                                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                                    display: 'flex',
                                    gap: '8px',
                                    alignItems: 'center'
                                }}>
                                    {isSearchingJobs ? (
                                        <>
                                            <SearchIcon />
                                            <span style={{ fontSize: '14px', color: '#6b7280' }}>
                                                Durchsuche JobbÃ¶rse...
                                            </span>
                                        </>
                                    ) : isUploadingCV ? (
                                        <>
                                            <UploadIcon />
                                            <span style={{ fontSize: '14px', color: '#6b7280' }}>
                                                Verarbeite Lebenslauf...
                                            </span>
                                        </>
                                    ) : (
                                        <>
                                            <div className="bounce-dot" style={{ animationDelay: '0s' }} />
                                            <div className="bounce-dot" style={{ animationDelay: '0.16s' }} />
                                            <div className="bounce-dot" style={{ animationDelay: '0.32s' }} />
                                        </>
                                    )}
                                </div>
                            </div>
                        )}

                        <div ref={messagesEndRef} />
                    </div>

                    {/* Saved Jobs Modal */}
                    {showSavedJobs && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            backgroundColor: 'rgba(0,0,0,0.5)',
                            display: 'flex',
                            justifyContent: 'center',
                            alignItems: 'center',
                            zIndex: 1000,
                            padding: '20px'
                        }}
                        onClick={() => setShowSavedJobs(false)}
                        >
                            <div style={{
                                backgroundColor: 'white',
                                borderRadius: '16px',
                                maxWidth: '900px',
                                width: '100%',
                                maxHeight: '90vh',
                                display: 'flex',
                                flexDirection: 'column',
                                boxShadow: '0 20px 50px rgba(0,0,0,0.3)'
                            }}
                            onClick={(e) => e.stopPropagation()}
                            >
                                <div style={{
                                    padding: '24px',
                                    borderBottom: '1px solid #e5e7eb',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <h2 style={{ margin: 0, fontSize: '24px', fontWeight: '600', color: '#1f2937' }}>
                                        ðŸ“‹ Gespeicherte Jobs ({savedJobs.length})
                                    </h2>
                                    <button
                                        onClick={() => setShowSavedJobs(false)}
                                        style={{
                                            backgroundColor: 'transparent',
                                            border: 'none',
                                            fontSize: '24px',
                                            cursor: 'pointer',
                                            color: '#6b7280',
                                            padding: '4px 8px'
                                        }}
                                    >
                                        âœ•
                                    </button>
                                </div>
                                
                                <div style={{
                                    flex: 1,
                                    overflowY: 'auto',
                                    padding: '20px'
                                }}>
                                    {savedJobs.length === 0 ? (
                                        <div style={{
                                            textAlign: 'center',
                                            padding: '60px 20px',
                                            color: '#6b7280'
                                        }}>
                                            <div style={{ fontSize: '48px', marginBottom: '16px' }}>ðŸ“‹</div>
                                            <p style={{ fontSize: '18px', margin: 0 }}>Noch keine Jobs gespeichert</p>
                                        </div>
                                    ) : (
                                        <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                            {[...savedJobs].sort((a, b) => b.fitScore - a.fitScore).map((job) => (
                                                <div key={job.id} style={{
                                                    backgroundColor: '#f9fafb',
                                                    borderRadius: '12px',
                                                    padding: '20px',
                                                    border: '2px solid #e5e7eb'
                                                }}>
                                                    <div style={{
                                                        display: 'inline-block',
                                                        backgroundColor: job.fitScore >= 80 ? '#10b981' : job.fitScore >= 60 ? '#f59e0b' : '#ef4444',
                                                        color: 'white',
                                                        padding: '4px 12px',
                                                        borderRadius: '20px',
                                                        fontSize: '14px',
                                                        fontWeight: '600',
                                                        marginBottom: '12px'
                                                    }}>
                                                        {job.fitScore}% Match
                                                    </div>

                                                    <h3 style={{ margin: '0 0 8px 0', fontSize: '18px', fontWeight: '600', color: '#1f2937' }}>
                                                        {job.title}
                                                    </h3>

                                                    <div style={{ display: 'flex', gap: '16px', fontSize: '14px', color: '#6b7280', marginBottom: '12px', flexWrap: 'wrap' }}>
                                                        <span>ðŸ¢ {job.company}</span>
                                                        <span>ðŸ“ {job.location}</span>
                                                        {job.salary && <span>ðŸ’° {job.salary}</span>}
                                                    </div>

                                                    <p style={{ fontSize: '14px', lineHeight: '1.6', color: '#374151', marginBottom: '16px' }}>
                                                        {job.description}
                                                    </p>

                                                    <div style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
                                                        <button
                                                            onClick={() => {
                                                                if (job.applyUrl) window.open(job.applyUrl, '_blank');
                                                            }}
                                                            style={{
                                                                flex: '1',
                                                                minWidth: '120px',
                                                                padding: '10px 16px',
                                                                backgroundColor: '#2563eb',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '8px'
                                                            }}
                                                        >
                                                            <CheckCircleIcon />
                                                            Bewerben
                                                        </button>
                                                        
                                                        <button
                                                            onClick={() => {
                                                                setSavedJobs(prev => prev.filter(j => j.id !== job.id));
                                                            }}
                                                            style={{
                                                                flex: '1',
                                                                minWidth: '120px',
                                                                padding: '10px 16px',
                                                                backgroundColor: '#ef4444',
                                                                color: 'white',
                                                                border: 'none',
                                                                borderRadius: '8px',
                                                                fontSize: '14px',
                                                                fontWeight: '600',
                                                                cursor: 'pointer',
                                                                display: 'flex',
                                                                alignItems: 'center',
                                                                justifyContent: 'center',
                                                                gap: '8px'
                                                            }}
                                                        >
                                                            <Trash2Icon />
                                                            Entfernen
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    <div style={{
                        padding: '20px',
                        backgroundColor: 'white',
                        borderTop: '1px solid #e5e7eb',
                        boxShadow: '0 -2px 4px rgba(0,0,0,0.05)'
                    }}>
                        <div style={{ display: 'flex', gap: '12px', alignItems: 'flex-end' }}>
                            <input
                                type="file"
                                ref={fileInputRef}
                                onChange={handleFileUpload}
                                accept=".txt,.pdf,.doc,.docx"
                                style={{ display: 'none' }}
                            />
                            
                            <button
                                onClick={() => fileInputRef.current?.click()}
                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                title="Lebenslauf hochladen"
                                style={{
                                    padding: '12px',
                                    backgroundColor: '#f3f4f6',
                                    border: '1px solid #d1d5db',
                                    borderRadius: '8px',
                                    cursor: (isLoading || isSearchingJobs || isUploadingCV) ? 'not-allowed' : 'pointer',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    opacity: (isLoading || isSearchingJobs || isUploadingCV) ? 0.5 : 1
                                }}
                            >
                                <FileUpIcon />
                            </button>

                            <textarea
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && !e.shiftKey) {
                                        e.preventDefault();
                                        handleSend();
                                    }
                                }}
                                placeholder="Schreibe deine Antwort..."
                                disabled={isLoading || isSearchingJobs || isUploadingCV}
                                style={{
                                    flex: 1,
                                    padding: '12px 16px',
                                    borderRadius: '8px',
                                    border: '1px solid #d1d5db',
                                    fontSize: '15px',
                                    resize: 'none',
                                    minHeight: '48px',
                                    maxHeight: '120px',
                                    fontFamily: 'inherit',
                                    outline: 'none'
                                }}
                                rows={1}
                            />

                            <button
                                onClick={handleSend}
                                disabled={!input.trim() || isLoading || isSearchingJobs || isUploadingCV}
                                style={{
                                    padding: '12px 24px',
                                    backgroundColor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? '#2563eb' : '#d1d5db',
                                    color: 'white',
                                    border: 'none',
                                    borderRadius: '8px',
                                    fontSize: '15px',
                                    fontWeight: '600',
                                    cursor: (input.trim() && !isLoading && !isSearchingJobs && !isUploadingCV) ? 'pointer' : 'not-allowed',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}
                            >
                                <SendIcon />
                                Senden
                            </button>
                        </div>
                        
                        <div style={{ marginTop: '12px', textAlign: 'center', fontSize: '12px', color: '#6b7280' }}>
                            Powered by Claude Â· Jobs von Bundesagentur fÃ¼r Arbeit
                        </div>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<SamCareerCoach />);
    </script>

    <style>
        .bounce-dot {
            width: 8px;
            height: 8px;
            borderRadius: 50%;
            backgroundColor: #2563eb;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1);
            }
        }
    </style>
</body>
</html>
